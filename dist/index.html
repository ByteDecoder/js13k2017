<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:768px;height:512px;transform:translate(-50%,-50%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var Stats=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";o=e}var o=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++o%n.children.length)},!1);var a=(performance||Date).now(),s=a,r=0,f=e(new Stats.Panel("FPS","#0ff","#002")),_=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var i=e(new Stats.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(_.update(e-a,200),e>s+1e3&&(f.update(1e3*r/(e-s),100),s=e,r=0,i)){var t=performance.memory;i.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:t}};Stats.Panel=function(e,t,o){var n=1/0,a=0,s=Math.round,r=s(window.devicePixelRatio||1),f=80*r,_=48*r,i=3*r,c=2*r,l=3*r,v=15*r,u=74*r,h=30*r,d=document.createElement("canvas");d.width=f,d.height=_,d.style.cssText="width:80px;height:48px";var m=d.getContext("2d");return m.font="bold "+9*r+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=o,m.fillRect(0,0,f,_),m.fillStyle=t,m.fillText(e,i,c),m.fillRect(l,v,u,h),m.fillStyle=o,m.globalAlpha=.9,m.fillRect(l,v,u,h),{dom:d,update:function(_,x){n=Math.min(n,_),a=Math.max(a,_),m.fillStyle=o,m.globalAlpha=1,m.fillRect(0,0,f,v),m.fillStyle=t,m.fillText(s(_)+" "+e+" ("+s(n)+"-"+s(a)+")",i,c),m.drawImage(d,l+r,v,u-r,h,l,v,u-r,h),m.fillRect(l+u-r,v,r,h),m.fillStyle=o,m.globalAlpha=.9,m.fillRect(l+u-r,v,r,s((1-_/x)*h))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(e){return Math.sin(6.283184*e)}function o(e){return.00390625*Math.pow(1.059463094,e-128)}function n(e,t){setTimeout(function(){var o=new Uint8Array(e*m*2),n=o.length-2,a=function(){for(var e=new Date,s=0;n>=0;)if(o[n]=0,o[n+1]=128,n-=2,(s+=1)%1e3==0&&new Date-e>x)return void setTimeout(a,0);setTimeout(function(){t(o)},0)};setTimeout(a,0)},0)}function a(e,t,o,n,a){var s=o.fx_delay_time*n>>1,r=o.fx_delay_amt/255,f=0,_=function(){for(var o=new Date,n=0;f<t-s;){var i=4*f,c=4*(f+s),l=e[c]+(e[c+1]<<8)+(e[i+2]+(e[i+3]<<8)-32768)*r;if(e[c]=255&l,e[c+1]=l>>8&255,l=e[c+2]+(e[c+3]<<8)+(e[i]+(e[i+1]<<8)-32768)*r,e[c+2]=255&l,e[c+3]=l>>8&255,++f,(n+=1)%1e3==0&&new Date-o>x)return void setTimeout(_,0)}setTimeout(a,0)};setTimeout(_,0)}function s(e){R.fill(e,D,D+131072)}function r(e,t,o){t|=0,o|=0,(e|=0)>0&&e<q&&t>0&&t<M&&(R[D+(t*q+e)]=o)}function f(e,t,o,n,a){var s,f,_=(n|=0)-(t|=0),i=(o|=0)-(e|=0);if(_<0?(_=-_,f=-1):f=1,i<0?(i=-i,s=-1):s=1,_<<=1,i<<=1,r(e,t,a),i>_)for(var c=_-(i>>1);e!=o;)c>=0&&(t+=f,c-=i),c+=_,r(e+=s,t,a);else for(c=i-(_>>1);t!=n;)c>=0&&(e+=s,c-=_),c+=i,r(e,t+=f,a)}function _(e,t,o,n){if(!(o<0)){e|=0,t|=0,n|=0;var a=-(o|=0),s=0,r=2-2*o;do{f(e-a,t-s,e+a,t-s,n),f(e-a,t+s,e+a,t+s,n),(o=r)<=s&&(r+=2*++s+1),(o>a||r>s)&&(r+=2*++a+1)}while(a<0)}}function i(e,t,o,n,a){x1=0|e,y1=0|t,x2=e+o|0,y2=t+n|0;var s=Math.abs(y2-y1);if(f(x1,y1,x2,y1,a),s>0)for(;--s;)f(x1,y1+s,x2,y1+s,a);f(x1,y2,x2,y2,a)}function c(e,t,o,n,a,s,r){var f=q,e=Math.round(16*e),o=Math.round(16*o),a=Math.round(16*a),t=Math.round(16*t),_=e-o,i=(n=Math.round(16*n))-t,c=o-a,l=(s=Math.round(16*s))-n,v=a-e,u=t-s,h=Math.max(Math.min(e,o,a)+15>>4,0),d=Math.min(Math.max(e,o,a)+15>>4,q),m=Math.max(Math.min(t,n,s)+15>>4,0),x=Math.min(Math.max(t,n,s)+15>>4,M);h&=-8,m&=-8;var y=-i*e-_*t,p=-l*o-c*n,w=-u*a-v*s;(i>0||0==i&&_>0)&&y++,(l>0||0==l&&c>0)&&p++,(u>0||0==u&&v>0)&&w++,y=y-1>>4,p=p-1>>4,w=w-1>>4;var K=0,T=0,S=0,b=0,k=0,g=0;_>=0?T-=7*_:K-=7*_,i>=0?T-=7*i:K-=7*i,c>=0?b-=7*c:S-=7*c,l>=0?b-=7*l:S-=7*l,v>=0?g-=7*v:k-=7*v,u>=0?g-=7*u:k-=7*u;for(var A=f-8,E=m;E<x;E+=8)for(var P=h;P<d;P+=8){var C=y+_*E+i*P,O=p+c*E+l*P,U=w+v*E+u*P;if(!(C<T||O<b||U<g)){var I=P+E*f;if(C>=K&&O>=S&&U>=k)for(L=0;L<8;L++){for(G=0;G<8;G++,I++)R[D+I]=r;I+=A}else for(var L=0;L<8;L++){for(var N=C,B=O,F=U,G=0;G<8;G++)(N|B|F)>=0&&(R[D+I]=r),N+=i,B+=l,F+=u,I++;C+=_,O+=c,U+=v,I+=A}}}}function l(){for(var e=K;e--;)P[e]=b[k[R[e]]];g.data.set(E),S.putImageData(g,0,0)}function v(e){for(var t=e[0].length,o=0;o<t;o++){var n=[];n=h(e[0].charAt(o));for(var a=0;a<5;a++)for(var s=0;s<5;s++)1==n[5*a+s]&&(1==e[4]?r(e[1]+s*e[4]+(5*e[4]+e[3])*o,e[2]+a*e[4],e[5]):i(e[1]+s*e[4]+(5*e[4]+e[3])*o,e[2]+a*e[4],e[4],e[4],e[5]))}}function u(e){var t=5*e[7],o=e[0].split("\n"),n=o.slice(0),a=o.length,s=n.sort(function(e,t){return t.length-e.length})[0],r=s.length*t+(s.length-1)*e[3],f=a*t+(a-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var _=e[1],i=e[2],c=e[1]+r,l=e[2]+f;"center"==e[5]?(_=e[1]-r/2,c=e[1]+r/2):"right"==e[5]&&(_=e[1]-r,c=e[1]),"center"==e[6]?(i=e[2]-f/2,l=e[2]+f/2):"bottom"==e[6]&&(i=e[2]-f,l=e[2]);for(var u=_+r/2,h=i+f/2,d=0;d<a;d++){var m=o[d],x=m.length*t+(m.length-1)*e[3],y=e[1],p=e[2]+(t+e[4])*d;"center"==e[5]?y=e[1]-x/2:"right"==e[5]&&(y=e[1]-x),"center"==e[6]?p-=f/2:"bottom"==e[6]&&(p-=f),v([m,y,p,e[3]||0,e[7]||1,e[8],e[9]])}return{sx:_,sy:i,cx:u,cy:h,ex:c,ey:l,width:r,height:f}}function h(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}var d={},m=2,x=33,y=null,p=[e,function(t){return e(t)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];d.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/m/2},d.AudioGenerator.prototype.getAudioBuffer=function(e){null===y&&(y=new AudioContext);var t=this.mixBuf,o=this.waveSize*m*2,n=y.createBuffer(m,this.waveSize,44100),a=n.getChannelData(0),s=n.getChannelData(1),r=0,f=function(){for(var _=new Date,i=0;r<o/2;){var c=4*(t[4*r]+(t[4*r+1]<<8)-32768);if(c=c<-32768?-32768:c>32767?32767:c,a[r]=c/32768,c=4*(t[4*r+2]+(t[4*r+3]<<8)-32768),c=c<-32768?-32768:c>32767?32767:c,s[r]=c/32768,r+=1,(i+=1)%1e3==0&&new Date-_>x)return void setTimeout(f,0)}setTimeout(function(){e(n)},0)};setTimeout(f,0)},d.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=p[e.lfo_waveform],this.osc1=p[e.osc1_waveform],this.osc2=p[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},d.SoundGenerator.prototype.genSound=function(t,n,a){new Date;for(var s=0,r=0,f=o(t+12*(this.instr.e-8)+this.instr.t)*(1+8e-4*this.instr.o),_=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),i=this.instr.fx_resonance/255,c=0,l=0,v=this.attack+this.sustain+this.release-1;v>=0;--v){var u=v+a,h=this.osc_lfo(u*this.lfoFreq)*this.instr.lfo_amt/512+.5,d=1;v<this.attack?d=v/this.attack:v>=this.attack+this.sustain&&(d-=(v-this.attack-this.sustain)/this.release);var m=f;this.instr.lfo_osc1_freq&&(m+=h),this.instr.osc1_xenv&&(m*=d*d),s+=m;var x=this.osc1(s)*this.instr.osc1_vol;m=_,this.instr.osc2_xenv&&(m*=d*d),r+=m,x+=this.osc2(r)*this.instr.osc2_vol,this.instr.noise_fader&&(x+=(2*Math.random()-1)*this.instr.noise_fader*d),x*=d/255;var y=this.instr.fx_freq;this.instr.lfo_fx_freq&&(y*=h);var p=i*(x-l)-(c+=(y=1.5*Math.sin(3.141592*y/44100))*l);switch(l+=y*p,this.instr.fx_filter){case 1:x=p;break;case 2:x=c;break;case 3:x=l;break;case 4:x=c+p}if(m=e(u*this.panFreq)*this.instr.fx_pan_amt/512+.5,x*=39*this.instr.env_master,(u*=4)+3<n.length){var w=n[u]+(n[u+1]<<8)+x*(1-m);n[u]=255&w,n[u+1]=w>>8&255,w=n[u+2]+(n[u+3]<<8)+x*m,n[u+2]=255&w,n[u+3]=w>>8&255}}},d.SoundGenerator.prototype._=function(e,t){var o=this.attack+this.sustain+this.release-1+32*this.rowLen,s=this;n(o,function(n){s.genSound(e,n,0),a(n,o,s.instr,s.rowLen,function(){t(new d.AudioGenerator(n))})})},d.SoundGenerator.prototype.createAudioBuffer=function(e,t){this._(e,function(e){e.getAudioBuffer(t)})},d.i=function(e){this.song=e,this.waveSize=44100*e.songLen},d.i.prototype.generateTrack=function(e,t,o){var s=this;n(this.waveSize,function(n){var r=s.waveSize,f=s.waveSize*m*2,_=s.song.rowLen,i=s.song.endPattern,c=new d.SoundGenerator(e,_),l=0,v=0,u=0,h=function(){for(var t=new Date;;)if(32!==u){if(v===i-1)return void setTimeout(y,0);var o=e.p[v];if(o){var a=e.c[o-1].n[u];a&&c.genSound(a,n,l)}if(l+=_,u+=1,new Date-t>x)return void setTimeout(h,0)}else u=0,v+=1},y=function(){a(n,r,e,_,w)},p=0,w=function(){for(var e=new Date,a=0;p<f;){var s=t[p]+(t[p+1]<<8)+n[p]+(n[p+1]<<8)-32768;if(t[p]=255&s,t[p+1]=s>>8&255,p+=2,(a+=1)%1e3==0&&new Date-e>x)return void setTimeout(w,0)}setTimeout(o,0)};setTimeout(h,0)})},d.i.prototype._=function(e){var t=this;n(this.waveSize,function(o){var n=0,a=function(){n<t.song.songData.length?(n+=1,t.generateTrack(t.song.songData[n-1],o,a)):e(new d.AudioGenerator(o))};a()})},d.i.prototype.createAudioBuffer=function(e){this._(function(t){t.getAudioBuffer(e)})};var w={songLen:37,songData:[{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{e:8,t:0,o:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]}]},{e:7,t:0,o:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]}]},{e:8,t:0,o:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9};fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";const q=384,M=256,K=q*M;var T=document.getElementById("canvas"),S=T.getContext("2d"),D=0,b=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],k=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];S.imageSmoothingEnabled=!1,S.mozImageSmoothingEnabled=!1,T.width=q,T.height=M;var g=S.getImageData(0,0,q,M),A=new ArrayBuffer(g.data.length),E=new Uint8Array(A),P=new Uint32Array(A),R=new Uint8ClampedArray(q*M*8);states={},init=(()=>{last=0,dt=0,now=0,t=0,songTrigger=!1,state="game",y=new AudioContext,currentRoom=4,player.init(),stats=new Stats,document.body.appendChild(stats.dom),loop()}),stopCapture=(e=>{}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("mousedown",function(e){stopCapture(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{stats.begin();let o=(new Date).getTime();dt=Math.min(1,(o-last)/1e3),t+=dt,states[state].render(),states[state].step(dt),last=o,l(),stats.end(),requestAnimationFrame(loop)}),world=[0,0,0,0,1,0,1,2,1],rooms=[{draw:function(e){u(["0",20,20,1,1,"left","bottom",2,15,0])}},{draw:function(e){u(["1",20,20,1,1,"left","bottom",2,15,0])}},{draw:function(e){u(["2",20,20,1,1,"left","bottom",2,15,0]),c(0,205,384,205,182,136,25)}}];new d.i(w);player={bullet:{x:0,y:0,xvel:0,yvel:0},init(){this.x=64,this.y=230,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=400,this.yspeed=400,this.drag=.6},update(e){this.bullet.x=player.x,this.bullet.y=player.y,this.xvel*=player.drag,this.yvel*=player.drag;let t=e*player.xvel,o=e*player.yvel;player.x+=t,player.y+=o,(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(player.xvel=player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(player.xvel=-player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&(player.yvel=-player.yspeed),(Key.isDown(Key.s)||Key.isDown(Key.DOWN))&&(player.yvel=player.yspeed),Key.isDown(Key.SPACE||Key.isDown(Key.z))&&(player.bullet.yvel=-350,bulletPool.get(player.bullet)),player.x>q&&(player.x=0,roomSwitch(RIGHT)),player.x<0&&(player.x=q,roomSwitch(LEFT)),player.y>M&&(player.y=0,roomSwitch(DOWN)),player.y<0&&(player.y=M,roomSwitch(UP))},draw(e){_(this.x,this.y,this.radius,21)}},states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(e){D=0,s(0),u(["GAME OVER",256,80+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",9,27])}},states.menu={step:function(e){Key.isDown(Key.p)&&(state="game")},render:function(e){D=0,s(0);let o=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)r(256+t+256*Math.cos(4*(e/128+o))+e,256+e+128*Math.sin(4*(t/256+o))+t,t/8%32);u(["LOSTGAME",q/2,40+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",6,21]),u(["PRESS P TO CONTINUE",q/2,230,2,2,"center","top",1,21])}},states.game={step(e){player.update(e)},render(e){D=0,s(1),rooms[currentRoom].draw,player.draw(e),D=0},roomSwitch:e=>e},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>