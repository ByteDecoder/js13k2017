<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:768px;height:512px;transform:translate(-50%,-30%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var Stats=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";n=t}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),e(++n%i.children.length)},!1);var o=(performance||Date).now(),r=o,a=0,s=t(new Stats.Panel("FPS","#0ff","#002")),l=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new Stats.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){o=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-o,200),t>r+1e3&&(s.update(1e3*a/(t-r),100),r=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:i,setMode:e}};Stats.Panel=function(t,e,n){var i=1/0,o=0,r=Math.round,a=r(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,f=2*a,h=3*a,c=15*a,d=74*a,p=30*a,x=document.createElement("canvas");x.width=s,x.height=l,x.style.cssText="width:80px;height:48px";var g=x.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=e,g.fillText(t,u,f),g.fillRect(h,c,d,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,c,d,p),{dom:x,update:function(l,y){i=Math.min(i,l),o=Math.max(o,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,c),g.fillStyle=e,g.fillText(r(l)+" "+t+" ("+r(i)+"-"+r(o)+")",u,f),g.drawImage(x,h+a,c,d-a,p,h,c,d-a,p),g.fillRect(h+d-a,c,a,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-a,c,a,r((1-l/y)*p))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(t){return Math.sin(6.283184*t)}function n(t){return.00390625*Math.pow(1.059463094,t-128)}function i(t,e){setTimeout(function(){var n=new Uint8Array(t*G*2),i=n.length-2,o=function(){for(var t=new Date,r=0;i>=0;)if(n[i]=0,n[i+1]=128,i-=2,(r+=1)%1e3==0&&new Date-t>z)return void setTimeout(o,0);setTimeout(function(){e(n)},0)};setTimeout(o,0)},0)}function o(t,e,n,i,o){var r=n.fx_delay_time*i>>1,a=n.fx_delay_amt/255,s=0,l=function(){for(var n=new Date,i=0;s<e-r;){var u=4*s,f=4*(s+r),h=t[f]+(t[f+1]<<8)+(t[u+2]+(t[u+3]<<8)-32768)*a;if(t[f]=255&h,t[f+1]=h>>8&255,h=t[f+2]+(t[f+3]<<8)+(t[u]+(t[u+1]<<8)-32768)*a,t[f+2]=255&h,t[f+3]=h>>8&255,++s,(i+=1)%1e3==0&&new Date-n>z)return void setTimeout(l,0)}setTimeout(o,0)};setTimeout(l,0)}function r(){tt=O,d(3,7,17,9,8),d(2,8,19,7,8),d(4,9,15,5,2),d(6,11,2,1,16),d(16,11,2,1,16),f(7,12,8,12,21),f(17,12,18,12,21),f(12,6,12,3,5),l(12,3,21),d(10,17,3,1,5),d(8,19,7,7,5),d(9,23,5,5,0),c(11,28,5,13),d(10,22,2,5,8),c(11,28,3,8),h(11,28,1,5),v(11,19,18,27,21,23,8)}function a(t){lt.fill(t,tt,tt+U)}function l(t,e,n){e|=0,n|=0,(t|=0)>0&&t<P&&e>0&&e<q&&(lt[tt+e*P+t]=n)}function u(t,e,n=tt){return lt[n+t+e*P]}function f(t,e,n,i,o){var r,a,s=(i|=0)-(e|=0),u=(n|=0)-(t|=0);if(s<0?(s=-s,a=-1):a=1,u<0?(u=-u,r=-1):r=1,s<<=1,u<<=1,l(t,e,o),u>s)for(var f=s-(u>>1);t!=n;)f>=0&&(e+=a,f-=u),f+=s,l(t+=r,e,o);else for(f=u-(s>>1);e!=i;)f>=0&&(t+=r,f-=s),f+=u,l(t,e+=a,o)}function h(t,e,n,i){var o=-n,r=0,a=2-2*n;do{l(t-o,e+r,i),l(t-r,e-o,i),l(t+o,e-r,i),l(t+r,e+o,i),(n=a)<=r&&(a+=2*++r+1),(n>o||a>r)&&(a+=2*++o+1)}while(o<0)}function c(t,e,n,i){if(!(n<0)){t|=0,e|=0,i|=0;var o=-(n|=0),r=0,a=2-2*n;do{f(t-o,e-r,t+o,e-r,i),f(t-o,e+r,t+o,e+r,i),(n=a)<=r&&(a+=2*++r+1),(n>o||a>r)&&(a+=2*++o+1)}while(o<0)}}function d(t,e,n,i,o){x1=0|t,y1=0|e,x2=t+n|0,y2=e+i|0;var r=Math.abs(y2-y1);if(f(x1,y1,x2,y1,o),r>0)for(;--r;)f(x1,y1+r,x2,y1+r,o);f(x1,y2,x2,y2,o)}function p(t,e,n,i,o,r){for(let a=0;a<=o;a++)d(t+a,e-a,n-2*a,i+2*a,r)}function g(t,e,n,i=n,o=n,r=n){for(let a=0;a<=P;a++)for(let s=0;s<=q;s++){let l=a-1+s*P,u=a+1+s*P,f=a+(s+1)*P,h=a+(s-1)*P;lt[t+(a+s*P)]&&(lt[t+l]||(lt[e+l]=n),lt[t+u]||(lt[e+u]=o),lt[t+h]||(lt[e+h]=i),lt[t+f]||(lt[e+f]=r))}}function v(t,e,n,i,o,r,a){var s=P,t=Math.round(16*t),n=Math.round(16*n),o=Math.round(16*o),e=Math.round(16*e),l=t-n,u=(i=Math.round(16*i))-e,f=n-o,h=(r=Math.round(16*r))-i,c=o-t,d=e-r,p=Math.max(Math.min(t,n,o)+15>>4,0),x=Math.min(Math.max(t,n,o)+15>>4,P),g=Math.max(Math.min(e,i,r)+15>>4,0),y=Math.min(Math.max(e,i,r)+15>>4,q);p&=-8,g&=-8;var v=-u*t-l*e,m=-h*n-f*i,w=-d*o-c*r;(u>0||0==u&&l>0)&&v++,(h>0||0==h&&f>0)&&m++,(d>0||0==d&&c>0)&&w++,v=v-1>>4,m=m-1>>4,w=w-1>>4;var R=0,I=0,S=0,_=0,M=0,b=0;l>=0?I-=7*l:R-=7*l,u>=0?I-=7*u:R-=7*u,f>=0?_-=7*f:S-=7*f,h>=0?_-=7*h:S-=7*h,c>=0?b-=7*c:M-=7*c,d>=0?b-=7*d:M-=7*d;for(var A=s-8,D=g;D<y;D+=8)for(var T=p;T<x;T+=8){var K=v+l*D+u*T,B=m+f*D+h*T,k=w+c*D+d*T;if(!(K<I||B<_||k<b)){var E=T+D*s;if(K>=R&&B>=S&&k>=M)for(L=0;L<8;L++){for(F=0;F<8;F++,E++)lt[tt+E]=a;E+=A}else for(var L=0;L<8;L++){for(var G=K,z=B,C=k,F=0;F<8;F++)(G|z|C)>=0&&(lt[tt+E]=a),G+=u,z+=h,C+=d,E++;K+=l,B+=f,k+=c,E+=A}}}}function m(t=0,e=0,n=384,i=256,o=0,r=0,a=!1,s=!1){for(var l=0;l<i;l++)for(var u=0;u<n;u++)r+l<q&&o+u<P&&r+l>-1&&o+u>-1&&(a&s?lt[et+((e+(i-l))*P+t+(n-u))]>0&&(lt[tt+((r+l)*P+o+u)]=it[lt[et+((e+(i-l))*P+t+(n-u))]]):s&&!a?lt[et+((e+(i-l))*P+t+u)]>0&&(lt[tt+((r+l)*P+o+u)]=lt[et+((e+(i-l))*P+t+u)]):a&&!s?lt[et+((e+l)*P+t+(n-u))]>0&&(lt[tt+((r+l)*P+o+u)]=lt[et+((e+l)*P+t+(n-u))]):a||s||lt[et+((e+l)*P+t+u)]>0&&(lt[tt+((r+l)*P+o+u)]=it[lt[et+((e+l)*P+t+u)]]))}function w(t,e,n,i,o,r,a,s){s*=.0174533;var l=t+n/2,u=e+i/2,f=n*a/2*1.41421356237|5,h=i*a/2*1.41421356237|5,c=-f,d=f,p=-h,x=h,g=1/a,y=Math.cos(-s)*g,v=Math.sin(-s)*g;for(let t=p;t<x;t++)for(let e=c;e<d;e++){let a=l+Math.round(y*e+v*t),s=u+Math.round(-v*e+y*t),f=e+o|0,h=t+r|0;a>=0&&s>=0&&a<n&&s<i&&lt[et+(s*P+a)]>0&&(lt[tt+(h*P+f)]=lt[et+(s*P+a)])}}function R(t,e,n,i,o,r,a){o=o||8,n/=r=r||8,i/=o;for(var s=0;s<o;++s)for(var l=0,u=r/2;l<u;++l)d(t+(2*l*n+(s%2?0:n)),s*i,n-1,i-1,a)}function I(){for(var t=U;t--;)st[t]=nt[it[lt[t]]];ot.data.set(at),$.putImageData(ot,0,0)}function S(t){switch(tt=J,a(0),tt=H,a(0),tt=N,a(0),tt=W,a(0),tt=V,a(0),tt=X,a(0),t){case ut:currentRoom[0]--,currentRoom[0]<0&&(currentRoom[0]=gt),console.log(currentRoom);break;case ft:currentRoom[0]++,currentRoom[0]>gt&&(currentRoom[0]=0),console.log(currentRoom);break;case ht:currentRoom[1]--,currentRoom[1]<0&&(currentRoom[1]=yt),console.log(currentRoom);break;case ct:currentRoom[1]++,currentRoom[1]>yt&&(currentRoom[1]=0),console.log(currentRoom)}tt=J,rooms[world[currentRoom[1]*(gt+1)+currentRoom[0]]].draw(),_()}function _(){M(),A(),D()}function M(){tt=Q,a(0);let t=5e3;for(;--t;)l(E.nextIntRange(0,384),E.nextIntRange(0,256),1);for(t=200;--t;)l(E.nextIntRange(0,384),E.nextIntRange(0,256),26);for(t=60;--t;)l(E.nextIntRange(0,384),E.nextIntRange(0,256),20);for(t=20;--t;)l(E.nextIntRange(0,384),E.nextIntRange(0,256),21);for(t=3;--t;)c(E.nextIntRange(0,384),E.nextIntRange(0,256),E.nextIntRange(2,5),E.nextIntRange(16,19))}function b(){let t=U;for(;--t;)if(lt[J+t]==xt){let e=t/P|0,n=t%P;c(n,e,3,9),h(n,e,3,11)}}function A(){et=J,tt=H,a(0);t=3e3;for(E.setSeed(1019);--t;){let t=E.nextIntRange(0,P),e=E.nextIntRange(0,q);u(t,e,J)==pt&&p(t+E.nextIntRange(-5,0),e+E.nextIntRange(-10,0),E.nextIntRange(0,15),E.nextIntRange(0,10),1,E.nextIntRange(22,24))}tt=N,a(0),g(H,N,25,20,26,2),tt=V,et=H,m(),et=N,m(),tt=H,a(0);var t=3e3;for(E.setSeed(1019);--t;){let t=E.nextIntRange(0,P),e=E.nextIntRange(0,q);lt[J+t+e*P]==pt&&p(t+E.nextIntRange(-5,0),e+E.nextIntRange(-10,0),E.nextIntRange(0,15),E.nextIntRange(0,10),1,E.nextIntRange(22,24))}tt=N,a(0),g(H,N,25,20,26,2),tt=V,et=H,m(),et=N,m()}function D(){tt=H,a(0);var t=1e3;for(E.setSeed(1019);--t;){let t=E.nextIntRange(0,P),e=E.nextIntRange(0,q);lt[J+t+e*P]==pt&&(d(t+E.nextIntRange(-5,0),e+E.nextIntRange(-20,0),E.nextIntRange(0,5),E.nextIntRange(0,20),E.nextIntRange(22,24)),c(t,e-10,2,E.nextIntRange(22,24)))}tt=N,a(0),g(H,N,25,20,26,2),tt=W,et=H,m(),et=N,m()}function T(t=0,e=0,n=10,i=10,o=21){this.x=t,this.y=e,this.maxSize=n,this.speed=10,this.counter=this.speed,this.color=o,this.size=1,s=this}function K(t){for(var e=t[0].length,n=0;n<e;n++){var i=[];i=k(t[0].charAt(n));for(var o=0;o<5;o++)for(var r=0;r<5;r++)1==i[5*o+r]&&(1==t[4]?l(t[1]+r*t[4]+(5*t[4]+t[3])*n,t[2]+o*t[4],t[5]):d(t[1]+r*t[4]+(5*t[4]+t[3])*n,t[2]+o*t[4],t[4],t[4],t[5]))}}function B(t){var e=5*t[7],n=t[0].split("\n"),i=n.slice(0),o=n.length,r=i.sort(function(t,e){return e.length-t.length})[0],a=r.length*e+(r.length-1)*t[3],s=o*e+(o-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var l=t[1],u=t[2],f=t[1]+a,h=t[2]+s;"center"==t[5]?(l=t[1]-a/2,f=t[1]+a/2):"right"==t[5]&&(l=t[1]-a,f=t[1]),"center"==t[6]?(u=t[2]-s/2,h=t[2]+s/2):"bottom"==t[6]&&(u=t[2]-s,h=t[2]);for(var c=l+a/2,d=u+s/2,p=0;p<o;p++){var x=n[p],g=x.length*e+(x.length-1)*t[3],y=t[1],v=t[2]+(e+t[4])*p;"center"==t[5]?y=t[1]-g/2:"right"==t[5]&&(y=t[1]-g),"center"==t[6]?v-=s/2:"bottom"==t[6]&&(v-=s),K([x,y,v,t[3]||0,t[7]||1,t[8],t[9]])}return{sx:l,sy:u,cx:c,cy:d,ex:f,ey:h,width:a,height:s}}function k(t){return index=fontString.indexOf(t),fontBitmap.substring(25*index,25*index+25).split("")}var E={seed:Date.now(),a:1664525,c:1013904223,m:Math.pow(2,32),setSeed:function(t){this.seed=t},nextInt:function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},nextFloat:function(){return this.nextInt()/this.m},nextBool:function(t){return null==t&&(t=.5),this.nextFloat()<t},nextFloatRange:function(t,e){return t+this.nextFloat()*(e-t)},nextIntRange:function(t,e){return Math.floor(this.nextFloatRange(t,e))},nextColor:function(){for(var t=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();t.length<6;)t="0"+t;return"#"+t}},L={},G=2,z=33,C=null,F=[e,function(t){return e(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];L.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/G/2},L.AudioGenerator.prototype.getAudioBuffer=function(t){null===C&&(C=new AudioContext);var e=this.mixBuf,n=this.waveSize*G*2,i=C.createBuffer(G,this.waveSize,44100),o=i.getChannelData(0),r=i.getChannelData(1),a=0,s=function(){for(var l=new Date,u=0;a<n/2;){var f=4*(e[4*a]+(e[4*a+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,o[a]=f/32768,f=4*(e[4*a+2]+(e[4*a+3]<<8)-32768),f=f<-32768?-32768:f>32767?32767:f,r[a]=f/32768,a+=1,(u+=1)%1e3==0&&new Date-l>z)return void setTimeout(s,0)}setTimeout(function(){t(i)},0)};setTimeout(s,0)},L.SoundGenerator=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=F[t.lfo_waveform],this.osc1=F[t.osc1_waveform],this.osc2=F[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen},L.SoundGenerator.prototype.genSound=function(t,i,o){new Date;for(var r=0,a=0,s=n(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=n(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),u=this.instr.fx_resonance/255,f=0,h=0,c=this.attack+this.sustain+this.release-1;c>=0;--c){var d=c+o,p=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,x=1;c<this.attack?x=c/this.attack:c>=this.attack+this.sustain&&(x-=(c-this.attack-this.sustain)/this.release);var g=s;this.instr.lfo_osc1_freq&&(g+=p),this.instr.osc1_xenv&&(g*=x*x),r+=g;var y=this.osc1(r)*this.instr.osc1_vol;g=l,this.instr.osc2_xenv&&(g*=x*x),a+=g,y+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(y+=(2*Math.random()-1)*this.instr.noise_fader*x),y*=x/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=p);var m=u*(y-h)-(f+=(v=1.5*Math.sin(3.141592*v/44100))*h);switch(h+=v*m,this.instr.fx_filter){case 1:y=m;break;case 2:y=f;break;case 3:y=h;break;case 4:y=f+m}if(g=e(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,y*=39*this.instr.env_master,(d*=4)+3<i.length){var w=i[d]+(i[d+1]<<8)+y*(1-g);i[d]=255&w,i[d+1]=w>>8&255,w=i[d+2]+(i[d+3]<<8)+y*g,i[d+2]=255&w,i[d+3]=w>>8&255}}},L.SoundGenerator.prototype.getAudioGenerator=function(t,e){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;i(n,function(i){r.genSound(t,i,0),o(i,n,r.instr,r.rowLen,function(){e(new L.AudioGenerator(i))})})},L.SoundGenerator.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})},L.MusicGenerator=function(t){this.song=t,this.waveSize=44100*t.songLen},L.MusicGenerator.prototype.generateTrack=function(t,e,n){var r=this;i(this.waveSize,function(i){var a=r.waveSize,s=r.waveSize*G*2,l=r.song.rowLen,u=r.song.endPattern,f=new L.SoundGenerator(t,l),h=0,c=0,d=0,p=function(){for(var e=new Date;;)if(32!==d){if(c===u-1)return void setTimeout(x,0);var n=t.p[c];if(n){var o=t.c[n-1].n[d];o&&f.genSound(o,i,h)}if(h+=l,d+=1,new Date-e>z)return void setTimeout(p,0)}else d=0,c+=1},x=function(){o(i,a,t,l,y)},g=0,y=function(){for(var t=new Date,o=0;g<s;){var r=e[g]+(e[g+1]<<8)+i[g]+(i[g+1]<<8)-32768;if(e[g]=255&r,e[g+1]=r>>8&255,g+=2,(o+=1)%1e3==0&&new Date-t>z)return void setTimeout(y,0)}setTimeout(n,0)};setTimeout(p,0)})},L.MusicGenerator.prototype.getAudioGenerator=function(t){var e=this;i(this.waveSize,function(n){var i=0,o=function(){i<e.song.songData.length?(i+=1,e.generateTrack(e.song.songData[i-1],n,o)):t(new L.AudioGenerator(n))};o()})},L.MusicGenerator.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})};fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";const P=384,q=256,U=P*q,Y=0,X=U,j=2*U,H=3*U,N=4*U,O=5*U,J=6*U,V=7*U,W=8*U,Q=9*U;var Z=document.getElementById("canvas"),$=Z.getContext("2d"),tt=0,et=U,nt=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],it=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];paldrk=[0,0,1,2,3,4,5,6,6,10,11,12,13,14,2,2,15,16,17,18,22,20,23,24,25,26,2,2,27,28,31,13],$.imageSmoothingEnabled=!1,$.mozImageSmoothingEnabled=!1,Z.width=P,Z.height=q;var ot=$.getImageData(0,0,P,q),rt=new ArrayBuffer(ot.data.length),at=new Uint8Array(rt),st=new Uint32Array(rt),lt=new Uint8ClampedArray(P*q*10);Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};const ut=1,ft=2,ht=3,ct=4,pt=21,xt=8;states={},init=(()=>{r(),sounds={},soundsLoaded=0,totalSounds=1,score=0,fuelAmount=0,parts=0,last=0,dt=0,now=0,t=0,songTrigger=!1,state="menu",C=new AudioContext,paused=!1,transition=!1,splodes=[],player.init(),stats=new Stats,document.body.appendChild(stats.dom),loop()}),window.addEventListener("keyup",function(t){Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){Key.onKeydown(t)},!1),window.addEventListener("blur",function(t){paused=!0},!1),window.addEventListener("focus",function(t){paused=!1},!1),loop=(e=>{if(paused);else{stats.begin();let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3),t+=dt,states[state].step(dt),last=e,states[state].render(),I(),stats.end(),requestAnimationFrame(loop)}}),world=[0,0,0,0,0,0,6,7,8];const gt=2,yt=2;currentRoom=[0,1],rooms=[{draw:function(t){}},{draw:function(t){}},{draw:function(t){}},{draw:function(t){d(0,0,127,256,pt),d(250,0,127,256,pt)}},{draw:function(t){d(0,0,127,256,pt),d(250,0,127,256,pt)}},{draw:function(t){}},{draw:function(t){d(0,205,384,100,pt);let e=400;for(;--e;)x=E.nextIntRange(0,P),y=E.nextIntRange(0,q),l(x,y,xt)}},{draw:function(t){v(0,256,384,256,182,205,pt),d(100,70,20,80,pt),d(100,140,100,20,pt),d(200,820,10,100,pt),d(210,70,100,100,pt)}},{draw:function(t){d(0,205,384,10,pt),c(250,150,64,pt),l(50,180,xt)}}],player={init(){this.x=192,this.y=30,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=200,this.yspeed=200,this.drag=.8,this.gravity=8,this.maxYvel=400,this.maxXvel=400,this.minYvel=-400,this.minXvel=-400,this.b={},this.facingLeft=!1,this.jumping=!1},update(t){this.updateB(),this.oldX=this.x,this.oldY=this.y,this.xvel*=player.drag,this.yvel+=player.gravity,this.yvel=this.yvel.clamp(this.minYvel,this.maxYvel),this.xvel=this.xvel.clamp(this.minXvel,this.maxXvel);let e=t*player.xvel,n=t*player.yvel;player.x+=e,this.updateB(),this.collides()&&(player.x=player.oldX,player.xvel=.4*-player.xvel),player.y+=n,this.updateB(),this.collides()&&(player.y=player.oldY,player.yvel=.4*-player.yvel),this.updateB(),this.collides()&&(this.x+=this.collideResolutionX(),this.updateB(),this.collides()&&(this.y+=this.collideResolutionY(),this.updateB())),this.overlapResolution(),this.updateB(),(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(player.facingLeft=!1,player.xvel=player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(this.facingLeft=!0,player.xvel=-player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&!this.jumping&&fuelAmount>0&&(player.yvel=-player.yspeed,fuelAmount--),player.x>P&&(player.x=0,S(ft)),player.x<0&&(player.x=P,S(ut)),player.y>q&&(player.y=0,S(ct)),player.y<0&&(player.y=q,S(ht))},draw(t){et=O,tt=X,m(0,0,19,34,this.x-this.radius|0,this.y-this.radius-12|0,this.facingLeft)},collides(){for(var t=-this.radius;t<this.radius;t++)for(var e=-this.radius;e<this.radius;e++)if(lt[J+(this.b.x+t)+(this.b.y+e)*P]==pt)return!0;return!1},overlaps(){for(var t=-this.radius;t<this.radius;t++)for(var e=-this.radius;e<this.radius;e++){let n=lt[J+(this.b.x+t)+(this.b.y+e)*P];if(n)return{x:this.b.x+t,y:this.b.y+e,o:n}}return!1},updateB(){this.b={left:this.x-this.radius|0,right:this.x+this.radius|0,top:this.y-this.radius|0,bottom:this.y+this.radius|0,width:2*this.radius,height:2*this.radius,x:0|this.x,y:0|this.y}},collideResolutionY(t){let e=0,n=this.b;for(let t=n.left;t<=n.right;t++)if(lt[J+t+P*n.bottom]==pt)for(let i=n.bottom;i>=n.top;i--)lt[J+t+P*i]==pt&&(e=i-n.bottom-1);for(let t=n.left;t<=n.right;t++)if(lt[J+t+P*n.top]==pt)for(let i=n.top;i<=n.bottom;i++)lt[J+t+P*i]==pt&&(e=i-n.top+1);return e},collideResolutionX(t){let e=0,n=this.b;for(let t=n.top;t<=n.bottom;t++)if(lt[J+n.left+P*t]==pt)for(let i=n.x;i<=n.right;i++)lt[J+i+P*t]==pt&&e++;else if(lt[J+n.right+P*t]==pt)for(let i=n.x;i>=n.left;i--)lt[J+i+P*t]==pt&&e--;for(let t=n.top+2;t<=n.bottom-2;t++)if(lt[J+n.right+P*t])for(let i=n.left;i<=n.right;i++)lt[J+i+P*t]&&(e=30);return e},overlapResolution(t){let e=player.overlaps();switch(e.o){case xt:lt[J+e.x+e.y*P],tt=J,c(e.x,e.y,3,0),tt=X,splodes.push(new T(e.x,e.y)),fuelAmount+=1,console.log(fuelAmount,e.x,e.y)}}},states.gameover={step:function(t){Key.isDown(Key.r)&&(state="menu")},render:function(e){tt=0,a(0),B(["CRITICAL SYSTEM FAILURE",192,80+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",4,27])}},states.menu={step:function(t){Key.isDown(Key.p)&&(S(),state="game"),Key.isDown(Key.z)&&(state="spritesheet")},render:function(e){tt=J,a(0),tt=0,a(0),tt=X,a(0),tt=H,a(0),tt=Y,a(0),tt=J,B(["GREEBLE",P/2,150,20,20,"center","top",6,25]),tt=X,et=J,m(),tt=N,E.setSeed(21);for(n=6e3;--n;){let t=E.nextIntRange(0,P),e=E.nextIntRange(0,q);lt[J+t+e*P]&&d(t+E.nextIntRange(-2,2),e+E.nextIntRange(-1,1),1,E.nextIntRange(0,3),E.nextIntRange(24,25))}g(N,H,25,20,23,18),tt=X,et=N,m(),et=H,m(),tt=N,E.setSeed(20);for(var n=6e3;--n;){let t=E.nextIntRange(0,P),e=E.nextIntRange(0,q);lt[J+t+e*P]&&d(t+E.nextIntRange(-1,1),e+E.nextIntRange(0,1),E.nextIntRange(1,5),1,E.nextIntRange(22,24))}g(N,H,25,20,23,18),tt=X,et=N,m(),et=H,m(),player.draw(),et=O;let i=8;for(;--i;)m(0,0,25,36,192+25*i,40);w(1,1,25,36,64,64,1,45),B(["PRESS P TO CONTINUE",P/2,230,2,2,"center","top",1,21]),tt=Y;for(o=8e3;--o;)l((E.nextIntRange(0,384)+10*t|0)%384,E.nextIntRange(0,256),1);for(o=400;--o;)l((E.nextIntRange(0,384)+20*t|0)%384,E.nextIntRange(0,256),26);for(var o=100;--o;)l((E.nextIntRange(0,384)+30*t|0)%384,E.nextIntRange(0,256),21);g(X,Y,15),et=X,m()}},states.game={step(t){player.update(t)},render(t){tt=X,a(0),et=Q,m(),b(),et=V,m(),player.draw(),et=W,m(),tt=Y,a(0),et=X,m(),et=j,m(),splodes.forEach(function(t){t.draw()})}},T.prototype.draw=function(){++this.size>this.maxSize||(h(this.x,this.y,this.size,this.color),0==--this.counter&&(this.size++,this.counter=this.speed))},states.spritesheet={step:function(t){Key.justReleased(Key.x)&&(S(),state="game")},render:function(t){tt=Y,R(0,0,384,256,12,19,1),et=O,m(),m(0,0,22,34,200,200),w(0,0,384,256,192,128,1,15);for(var e=0;e<32;e++)B([e.toString(),e<16?3+16*e:3+16*(e-16),e<16?40:56,1,1,1,"left",1,e,0])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>