<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:144vmin;height:96vmin;transform:translate(-50%,-25%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
!function(){function e(e){fe.fill(e,ee,ee+H)}function o(e,t,n){t|=0,n|=0,(e|=0)>0&&e<k&&t>0&&t<z&&(fe[ee+t*k+e]=n)}function r(e,t,n=ee){return fe[n+e+t*k]}function a(e,t,n,s,r){var a,i,f=(s|=0)-(t|=0),c=(n|=0)-(e|=0);if(f<0?(f=-f,i=-1):i=1,c<0?(c=-c,a=-1):a=1,f<<=1,c<<=1,o(e,t,r),c>f)for(var l=f-(c>>1);e!=n;)l>=0&&(t+=i,l-=c),l+=f,o(e+=a,t,r);else for(l=c-(f>>1);t!=s;)l>=0&&(e+=a,l-=f),l+=c,o(e,t+=i,r)}function f(e,t,n,s){var r=-n,a=0,i=2-2*n;do{o(e-r,t+a,s),o(e-a,t-r,s),o(e+r,t-a,s),o(e+a,t+r,s),(n=i)<=a&&(i+=2*++a+1),(n>r||i>a)&&(i+=2*++r+1)}while(r<0)}function c(e,t,n,o){if(!(n<0)){e|=0,t|=0,o|=0;var s=-(n|=0),r=0,i=2-2*n;do{a(e-s,t-r,e+s,t-r,o),a(e-s,t+r,e+s,t+r,o),(n=i)<=r&&(i+=2*++r+1),(n>s||i>r)&&(i+=2*++s+1)}while(s<0)}}function l(e,t,n,o,s){x1=0|e,y1=0|t,x2=e+n|0,y2=t+o|0;var r=Math.abs(y2-y1);if(a(x1,y1,x2,y1,s),r>0)for(;--r;)a(x1,y1+r,x2,y1+r,s);a(x1,y2,x2,y2,s)}function u(e,t,n,o,s,r){for(let a=0;a<=s;a++)l(e+a,t-a,n-2*a,o+2*a,r)}function _(e,t,n,o=n,s=n,r=n){for(let a=0;a<=k;a++)for(let i=0;i<=z;i++){let f=a-1+i*k,c=a+1+i*k,l=a+(i+1)*k,u=a+(i-1)*k;fe[e+(a+i*k)]&&(fe[e+f]||(fe[t+f]=n),fe[e+c]||(fe[t+c]=s),fe[e+u]||(fe[t+u]=o),fe[e+l]||(fe[t+l]=r))}}function h(e,t,n,o,s,r,a){var i=k,e=Math.round(16*e),n=Math.round(16*n),s=Math.round(16*s),t=Math.round(16*t),f=e-n,c=(o=Math.round(16*o))-t,l=n-s,u=(r=Math.round(16*r))-o,_=s-e,h=t-r,d=Math.max(Math.min(e,n,s)+15>>4,0),x=Math.min(Math.max(e,n,s)+15>>4,k),v=Math.max(Math.min(t,o,r)+15>>4,0),m=Math.min(Math.max(t,o,r)+15>>4,z);d&=-8,v&=-8;var p=-c*e-f*t,y=-u*n-l*o,g=-h*s-_*r;(c>0||0==c&&f>0)&&p++,(u>0||0==u&&l>0)&&y++,(h>0||0==h&&_>0)&&g++,p=p-1>>4,y=y-1>>4,g=g-1>>4;var A=0,w=0,B=0,R=0,I=0,C=0;f>=0?w-=7*f:A-=7*f,c>=0?w-=7*c:A-=7*c,l>=0?R-=7*l:B-=7*l,u>=0?R-=7*u:B-=7*u,_>=0?C-=7*_:I-=7*_,h>=0?C-=7*h:I-=7*h;for(var D=i-8,M=v;M<m;M+=8)for(var S=d;S<x;S+=8){var q=p+f*M+c*S,G=y+l*M+u*S,E=g+_*M+h*S;if(!(q<w||G<R||E<C)){var L=S+M*i;if(q>=A&&G>=B&&E>=I)for(F=0;F<8;F++){for(H=0;H<8;H++,L++)fe[ee+L]=a;L+=D}else for(var F=0;F<8;F++){for(var K=q,T=G,b=E,H=0;H<8;H++)(K|T|b)>=0&&(fe[ee+L]=a),K+=c,T+=u,b+=h,L++;q+=f,G+=l,E+=_,L+=D}}}}function d(e=0,t=0,n=384,o=256,s=0,r=0,a=!1,i=!1){for(var f=0;f<o;f++)for(var c=0;c<n;c++)r+f<z&&s+c<k&&r+f>-1&&s+c>-1&&(a&i?fe[te+((t+(o-f))*k+e+(n-c))]>0&&(fe[ee+((r+f)*k+s+c)]=oe[fe[te+((t+(o-f))*k+e+(n-c))]]):i&&!a?fe[te+((t+(o-f))*k+e+c)]>0&&(fe[ee+((r+f)*k+s+c)]=fe[te+((t+(o-f))*k+e+c)]):a&&!i?fe[te+((t+f)*k+e+(n-c))]>0&&(fe[ee+((r+f)*k+s+c)]=fe[te+((t+f)*k+e+(n-c))]):a||i||fe[te+((t+f)*k+e+c)]>0&&(fe[ee+((r+f)*k+s+c)]=oe[fe[te+((t+f)*k+e+c)]]))}function v(e,t,n,o,s,r,a,i){i*=.0174533;let f=e+n/2|0,c=t+o/2|0,l=n*a/2*1.41421356237|5,u=o*a/2*1.41421356237|5,_=-l,h=l,d=-u,x=u,v=1/a,m=Math.cos(-i)*v,p=Math.sin(-i)*v;for(let e=d;e<x;e++)for(let t=_;t<h;t++){let a=f+Math.round(m*t+p*e),i=c+Math.round(-p*t+m*e),l=t+s|0,u=e+r|0;a>=0&&i>=0&&a<n&&i<o&&fe[te+(i*k+a)]>0&&(fe[ee+(u*k+l)]=fe[te+(i*k+a)])}}function m(e,t,n,o,s,r,a){s=s||8,n/=r=r||8,o/=s;for(var i=0;i<s;++i)for(var f=0,c=r/2;f<c;++f)l(e+(2*f*n+(i%2?0:n)),i*o,n-1,o-1,a)}function g(){for(var e=H;e--;)ie[e]=ne[oe[fe[e]]];se.data.set(ae),$.putImageData(se,0,0)}function A(){ee=Y,te=Y,l(8,10,17,9,8),l(7,11,19,7,8),l(9,12,15,5,2),l(11,14,2,1,16),l(21,14,2,1,16),a(12,15,13,15,21),a(22,15,23,15,21),a(17,9,17,6,5),o(17,6,21),l(42,17,3,1,5),l(40,19,7,7,5),l(41,23,5,5,0),c(139,28,5,13),l(74,22,2,5,8),c(75,28,3,8),f(75,28,1,5),h(107,19,114,27,117,23,8),_(Y,j,23,21,31,23),te=j,d(),te=Y,d(96,0,32,32,165,3),d(32,0,32,32,165,3),d(64,0,32,32,165,3),d(0,0,32,32,160,0)}function w(e){return Math.sin(6.283184*e)}function B(e){return.00390625*Math.pow(1.059463094,e-128)}function R(e,t){setTimeout(function(){var n=new Uint8Array(e*de*2),o=n.length-2,s=function(){for(var e=new Date,r=0;o>=0;)if(n[o]=0,n[o+1]=128,o-=2,(r+=1)%1e3==0&&new Date-e>xe)return void setTimeout(s,0);setTimeout(function(){t(n)},0)};setTimeout(s,0)},0)}function I(e,t,n,o,s){var r=n.fx_delay_time*o>>1,a=n.fx_delay_amt/255,i=0,f=function(){for(var n=new Date,o=0;i<t-r;){var c=4*i,l=4*(i+r),u=e[l]+(e[l+1]<<8)+(e[c+2]+(e[c+3]<<8)-32768)*a;if(e[l]=255&u,e[l+1]=u>>8&255,u=e[l+2]+(e[l+3]<<8)+(e[c]+(e[c+1]<<8)-32768)*a,e[l+2]=255&u,e[l+3]=u>>8&255,++i,(o+=1)%1e3==0&&new Date-n>xe)return void setTimeout(f,0)}setTimeout(s,0)};setTimeout(f,0)}function C(t){switch(ee=X,e(0),ee=O,e(0),ee=U,e(0),ee=Z,e(0),ee=J,e(0),ee=j,e(0),t){case pe:currentRoom[0]--,currentRoom[0]<0&&(currentRoom[0]=Ce),console.log(currentRoom);break;case ye:currentRoom[0]++,currentRoom[0]>Ce&&(currentRoom[0]=0),console.log(currentRoom);break;case ge:currentRoom[1]--,currentRoom[1]<0&&(currentRoom[1]=De),console.log(currentRoom);break;case Ae:currentRoom[1]++,currentRoom[1]>De&&(currentRoom[1]=0),console.log(currentRoom)}ee=X,rooms[world[currentRoom[1]*(Ce+1)+currentRoom[0]]].draw()}function D(e,t,s){for(ee=Z,u(e-4,t-4,40,100,23),n=p=i=0;p<2e3;i%2||o(e+p%23,t+p/23|0,s),p++)p^n||(n=p+(63&[..."F0AL1314B2C2B16001177AeBSB1SB1R11AREàBDCCB5CAM6A51CBCB513333ZAQAÜAQFMEWB5DCCBC4IA515CC613333ZAFBIAKBO3BJFEBFEJBMAHAH3AFBGAGB5FAJBCA5O6BMBCA5IB5F4FAH3AGBH2HBH2IAG34G4LBIBHBIACC17K4N3ELAD1C1B1B7F7CB7GACDCEBACI13CA6AF13FBAF13BF3B7cCEANC11C0117CI0AP1ANEPILCGCIBKBGB1I1BE6BG6BDAC1312D2B2B2HAC12LADADALAIAN71AK5E1BD"].map(e=>["AAAAAA","AA","ACA","AE","AGA","DB","BB","AB"][e]||e).join("").charCodeAt(i++)))}function M(){ee=Q,e(0);let t=5e3;for(;--t;)o(_e.nextIntRange(0,384),_e.nextIntRange(0,256),1);for(t=200;--t;)o(_e.nextIntRange(0,384),_e.nextIntRange(0,256),26);for(t=60;--t;)o(_e.nextIntRange(0,384),_e.nextIntRange(0,256),20);for(t=20;--t;)o(_e.nextIntRange(0,384),_e.nextIntRange(0,256),21);for(t=3;--t;)c(_e.nextIntRange(0,384),_e.nextIntRange(0,256),_e.nextIntRange(2,5),_e.nextIntRange(16,19))}function S(){let e=H;for(;--e;)if(fe[X+e]==Be){let t=e/k|0,n=e%k;c(n,t,3,9),f(n,t,3,11)}}function q(){te=X,ee=O,e(0);t=3e3;for(_e.setSeed(1019);--t;){let e=_e.nextIntRange(0,k),t=_e.nextIntRange(0,z);r(e,t,X)==we&&u(e+_e.nextIntRange(-5,0),t+_e.nextIntRange(-10,0),_e.nextIntRange(0,15),_e.nextIntRange(0,10),1,_e.nextIntRange(22,24))}ee=U,e(0),_(O,U,25,20,26,2),ee=J,te=O,d(),te=U,d(),ee=O,e(0);var t=3e3;for(_e.setSeed(1019);--t;){let e=_e.nextIntRange(0,k),t=_e.nextIntRange(0,z);fe[X+e+t*k]==we&&u(e+_e.nextIntRange(-5,0),t+_e.nextIntRange(-10,0),_e.nextIntRange(0,15),_e.nextIntRange(0,10),1,_e.nextIntRange(22,24))}ee=U,e(0),_(O,U,25,20,26,2),ee=J,te=O,d(),te=U,d()}function G(){ee=O,e(0);var t=1e3;for(_e.setSeed(1019);--t;){let e=_e.nextIntRange(0,k),t=_e.nextIntRange(0,z);fe[X+e+t*k]==we&&(l(e+_e.nextIntRange(-5,0),t+_e.nextIntRange(-20,0),_e.nextIntRange(0,5),_e.nextIntRange(0,20),_e.nextIntRange(22,24)),c(e,t-10,2,_e.nextIntRange(22,24)))}ee=U,e(0),_(O,U,25,20,26,2),ee=Z,te=O,d(),te=U,d()}function E(){let e=H;for(;--e;)fe[X+e]==Ie&&(fe[J+e]=_e.nextIntRange(2,4))}function L(){let e=H;for(;--e;)fe[X+e]==Re&&(fe[J+e]=_e.nextIntRange(9,11))}function F(e=0,t=0,n=10,o=10,r=21,a=!1){this.x=e,this.y=t,this.maxSize=n,this.speed=10,this.counter=this.speed,this.color=r,this.size=1,this.filled=a,s=this}function K(e){for(var t=e[0].length,n=0;n<t;n++){var s=[];s=b(e[0].charAt(n));for(var r=0;r<5;r++)for(var a=0;a<5;a++)1==s[5*r+a]&&(1==e[4]?o(e[1]+a*e[4]+(5*e[4]+e[3])*n,e[2]+r*e[4],e[5]):l(e[1]+a*e[4]+(5*e[4]+e[3])*n,e[2]+r*e[4],e[4],e[4],e[5]))}}function T(e){var t=5*e[7],n=e[0].split("\n"),o=n.slice(0),s=n.length,r=o.sort(function(e,t){return t.length-e.length})[0],a=r.length*t+(r.length-1)*e[3],i=s*t+(s-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var f=e[1],c=e[2],l=e[1]+a,u=e[2]+i;"center"==e[5]?(f=e[1]-a/2,l=e[1]+a/2):"right"==e[5]&&(f=e[1]-a,l=e[1]),"center"==e[6]?(c=e[2]-i/2,u=e[2]+i/2):"bottom"==e[6]&&(c=e[2]-i,u=e[2]);for(var _=f+a/2,h=c+i/2,d=0;d<s;d++){var x=n[d],v=x.length*t+(x.length-1)*e[3],m=e[1],p=e[2]+(t+e[4])*d;"center"==e[5]?m=e[1]-v/2:"right"==e[5]&&(m=e[1]-v),"center"==e[6]?p-=i/2:"bottom"==e[6]&&(p-=i),K([x,m,p,e[3]||0,e[7]||1,e[8],e[9]])}return{sx:f,sy:c,cx:_,cy:h,ex:l,ey:u,width:a,height:i}}function b(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}const k=384,z=256,H=k*z,N=0,j=H,P=2*H,O=3*H,U=4*H,Y=5*H,X=6*H,J=7*H,Z=8*H,Q=9*H,W=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];var V=document.getElementById("canvas"),$=V.getContext("2d"),ee=0,te=H,ne=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],oe=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];paldrk=[0,0,1,2,3,4,5,6,6,10,11,12,13,14,2,2,15,16,17,18,22,20,23,24,25,26,2,2,27,28,31,13],$.imageSmoothingEnabled=!1,$.mozImageSmoothingEnabled=!1,V.width=k,V.height=z;var se=$.getImageData(0,0,k,z),re=new ArrayBuffer(se.data.length),ae=new Uint8Array(re),ie=new Uint32Array(re),fe=new Uint8ClampedArray(k*z*10);Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},Number.prototype.map=function(e,t,n,o){return(this-e)/(t-e)*(o-n)+n};var ce={rowLen:5513,endPattern:17,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:128,osc1_waveform:2,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:142,osc2_waveform:3,noise_fader:0,env_attack:137,env_sustain:2653,env_release:1979,env_master:155,fx_filter:3,fx_freq:1052,fx_resonance:154,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:8,fx_pan_amt:144,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[2,2,3,3,2,2,3,3,2,2,3,3,2,2,3,3],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[171,166,169,171,174,171,169,171,0,166,169,171,174,171,169,171,171,166,169,171,174,171,169,171,0,166,169,171,174,171,169,171]},{n:[169,164,167,169,172,169,167,169,0,164,167,169,172,169,167,169,169,164,167,169,172,169,167,169,0,164,167,169,172,169,167,169]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:116,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:8,osc2_xenv:0,osc2_vol:255,osc2_waveform:2,noise_fader:0,env_attack:351,env_sustain:4611,env_release:1403,env_master:199,fx_filter:2,fx_freq:200,fx_resonance:254,fx_delay_time:5,fx_delay_amt:12,fx_pan_freq:0,fx_pan_amt:214,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:87,lfo_waveform:3,p:[1,1,2,2,1,1,2,2,1,1,2,2,1,1,2,2],c:[{n:[123,0,0,121,0,0,123,0,0,0,0,0,0,0,121,0,123,0,0,121,0,0,123,0,0,0,0,0,0,0,0,0]},{n:[121,0,0,119,0,0,121,0,0,0,0,0,0,0,119,0,121,0,0,119,0,0,121,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:162,osc1_waveform:0,osc2_oct:6,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:162,osc2_waveform:0,noise_fader:14,env_attack:50,env_sustain:150,env_release:8181,env_master:161,fx_filter:2,fx_freq:5900,fx_resonance:240,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[123,0,0,123,0,0,0,123,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:29,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:2,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[0,123,123,123,0,123,123,123,0,123,0,123,0,123,123,123,0,123,123,123,0,123,0,123,0,123,123,123,0,123,123,123]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:197,env_sustain:13163,env_release:10614,env_master:180,fx_filter:2,fx_freq:1792,fx_resonance:136,fx_delay_time:6,fx_delay_amt:81,fx_pan_freq:3,fx_pan_amt:151,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,3,4,5,2,3,4,5,2,3,4,5,2,3,4],c:[{n:[162,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,171,0,0,0,0,0,0,0,166,0,0,0,0,0,0,0]},{n:[164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,162,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,169,0,0,0,0,0,0,0,0,0,0,0,167,0,0,0]},{n:[166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,0,0,0,0,0,0,0,0,0,0,167,0,0,0]}]}],songLen:69},le={rowLen:5513,endPattern:21,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:191,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:125,osc2_waveform:1,noise_fader:0,env_attack:200,env_sustain:2e3,env_release:2418,env_master:73,fx_filter:2,fx_freq:6620,fx_resonance:130,fx_delay_time:6,fx_delay_amt:48,fx_pan_freq:4,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[137,0,140,0,144,0,147,0,137,0,140,0,144,0,147,0,137,0,140,0,144,0,147,0,137,0,140,0,144,0,147,0]},{n:[137,0,140,0,144,0,146,0,137,0,140,0,144,0,146,0,137,0,140,0,144,0,146,0,137,0,140,0,144,0,146,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:1776,env_release:1403,env_master:45,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:65,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[125,0,0,123,0,0,125,0,0,0,0,0,0,0,123,0,125,0,0,123,0,0,125,0,0,0,0,0,0,0,0,0]},{n:[130,0,0,128,0,0,130,0,0,0,0,0,0,0,128,0,130,0,0,128,0,0,130,0,0,0,0,0,0,0,0,0]}]}],songLen:85},ue={osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:117,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:155,osc2_waveform:2,noise_fader:0,env_attack:7105,env_sustain:0,env_release:444,env_master:192,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:16,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:59,lfo_waveform:0};fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";var _e={seed:Date.now(),a:1664525,c:1013904223,m:Math.pow(2,32),setSeed:function(e){this.seed=e},nextInt:function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},nextFloat:function(){return this.nextInt()/this.m},nextBool:function(e){return null==e&&(e=.5),this.nextFloat()<e},nextFloatRange:function(e,t){return e+this.nextFloat()*(t-e)},nextIntRange:function(e,t){return Math.floor(this.nextFloatRange(e,t))},nextColor:function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();e.length<6;)e="0"+e;return"#"+e}},he={},de=2,xe=33,ve=null,me=[w,function(e){return w(e)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];he.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/de/2},he.AudioGenerator.prototype.getAudioBuffer=function(e){null===ve&&(ve=new AudioContext);var t=this.mixBuf,n=this.waveSize*de*2,o=ve.createBuffer(de,this.waveSize,44100),s=o.getChannelData(0),r=o.getChannelData(1),a=0,i=function(){for(var f=new Date,c=0;a<n/2;){var l=4*(t[4*a]+(t[4*a+1]<<8)-32768);if(l=l<-32768?-32768:l>32767?32767:l,s[a]=l/32768,l=4*(t[4*a+2]+(t[4*a+3]<<8)-32768),l=l<-32768?-32768:l>32767?32767:l,r[a]=l/32768,a+=1,(c+=1)%1e3==0&&new Date-f>xe)return void setTimeout(i,0)}setTimeout(function(){e(o)},0)};setTimeout(i,0)},he.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=me[e.lfo_waveform],this.osc1=me[e.osc1_waveform],this.osc2=me[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},he.SoundGenerator.prototype.genSound=function(e,t,n){new Date;for(var o=0,s=0,r=B(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),a=B(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),i=this.instr.fx_resonance/255,f=0,c=0,l=this.attack+this.sustain+this.release-1;l>=0;--l){var u=l+n,_=this.osc_lfo(u*this.lfoFreq)*this.instr.lfo_amt/512+.5,h=1;l<this.attack?h=l/this.attack:l>=this.attack+this.sustain&&(h-=(l-this.attack-this.sustain)/this.release);var d=r;this.instr.lfo_osc1_freq&&(d+=_),this.instr.osc1_xenv&&(d*=h*h),o+=d;var x=this.osc1(o)*this.instr.osc1_vol;d=a,this.instr.osc2_xenv&&(d*=h*h),s+=d,x+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(x+=(2*Math.random()-1)*this.instr.noise_fader*h),x*=h/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=_);var m=i*(x-c)-(f+=(v=1.5*Math.sin(3.141592*v/44100))*c);switch(c+=v*m,this.instr.fx_filter){case 1:x=m;break;case 2:x=f;break;case 3:x=c;break;case 4:x=f+m}if(d=w(u*this.panFreq)*this.instr.fx_pan_amt/512+.5,x*=39*this.instr.env_master,(u*=4)+3<t.length){var p=t[u]+(t[u+1]<<8)+x*(1-d);t[u]=255&p,t[u+1]=p>>8&255,p=t[u+2]+(t[u+3]<<8)+x*d,t[u+2]=255&p,t[u+3]=p>>8&255}}},he.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;R(n,function(s){o.genSound(e,s,0),I(s,n,o.instr,o.rowLen,function(){t(new he.AudioGenerator(s))})})},he.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},he.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},he.MusicGenerator.prototype.generateTrack=function(e,t,n){var o=this;R(this.waveSize,function(s){var r=o.waveSize,a=o.waveSize*de*2,i=o.song.rowLen,f=o.song.endPattern,c=new he.SoundGenerator(e,i),l=0,u=0,_=0,h=function(){for(var t=new Date;;)if(32!==_){if(u===f-1)return void setTimeout(d,0);var n=e.p[u];if(n){var o=e.c[n-1].n[_];o&&c.genSound(o,s,l)}if(l+=i,_+=1,new Date-t>xe)return void setTimeout(h,0)}else _=0,u+=1},d=function(){I(s,r,e,i,v)},x=0,v=function(){for(var e=new Date,o=0;x<a;){var r=t[x]+(t[x+1]<<8)+s[x]+(s[x+1]<<8)-32768;if(t[x]=255&r,t[x+1]=r>>8&255,x+=2,(o+=1)%1e3==0&&new Date-e>xe)return void setTimeout(v,0)}setTimeout(n,0)};setTimeout(h,0)})},he.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;R(this.waveSize,function(n){var o=0,s=function(){o<t.song.songData.length?(o+=1,t.generateTrack(t.song.songData[o-1],n,s)):e(new he.AudioGenerator(n))};s()})},he.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})},states={},init=(()=>{sounds={},soundsLoaded=0,totalSounds=3,score=0,fuelTimer=10,parts=0,last=0,dt=0,now=0,t=0,state="menu",splodes=[],paused=!1,transition=!1,s_titleSong=!1,s_gameSong=!1,s_jump=!1,ve=new AudioContext,A(),player.init(),loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{if(paused)oe=paldrk,T(["PAUSED",192,128,1,1,1,"center",1,21,0]);else{oe=W;let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3),t+=dt,states[state].step(dt),last=e,states[state].render()}g(),requestAnimationFrame(loop)}),world=[8,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,7,6,6,8,6,6,6];const pe=1,ye=2,ge=3,Ae=4,we=21,Be=8,Re=9,Ie=4,Ce=9,De=5;currentRoom=[0,0],rooms=[{draw:function(e){M(),q(),G()}},{draw:function(e){c(192,128,50,we),M(),q(),G()}},{draw:function(e){f(192,128,64,we),M(),q(),G()}},{draw:function(e){l(0,0,127,256,we),l(250,0,127,256,we),M(),q(),G()}},{draw:function(e){l(0,0,127,256,we),l(250,0,127,256,we),M(),q(),G()}},{draw:function(e){}},{draw:function(e){l(0,205,384,100,we),l(0,150,100,100,Ie),l(300,150,100,100,Re);let t=100;for(;--t;)x=_e.nextIntRange(0,k),y=_e.nextIntRange(100,200),o(x,y,Be);M(),E(),L(),q(),G()}},{draw:function(e){h(0,256,384,256,182,205,we),l(100,70,20,80,we),l(100,140,100,20,we),l(200,820,10,100,we),l(210,70,100,100,we),M(),q(),G()}},{draw:function(e){l(0,205,384,10,we),c(250,150,64,we),o(50,180,Be),M(),q(),G(),D(245,110,25)}}],player={init(){this.x=192,this.y=30,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=200,this.yspeed=200,this.drag=.8,this.gravity=8,this.maxYvel=400,this.maxXvel=400,this.minYvel=-400,this.minXvel=-400,this.b={},this.facingLeft=!1,this.jumping=!1},update(e){this.updateB(),this.oldX=this.x,this.oldY=this.y,this.xvel*=player.drag,this.yvel+=player.gravity,this.yvel=this.yvel.clamp(this.minYvel,this.maxYvel),this.xvel=this.xvel.clamp(this.minXvel,this.maxXvel);let t=e*player.xvel,n=e*player.yvel;player.x+=t,this.updateB(),this.collides()&&(player.x=player.oldX,player.xvel=.4*-player.xvel),player.y+=n,this.updateB(),this.collides()&&(player.y=player.oldY,player.yvel=.4*-player.yvel),this.updateB(),this.collides()&&(this.x+=this.collideResolutionX(),this.updateB(),this.collides()&&(this.y+=this.collideResolutionY(),this.updateB())),this.overlapResolution(),this.updateB(),(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(player.facingLeft=!1,player.xvel=player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(this.facingLeft=!0,player.xvel=-player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&!this.jumping&&fuelTimer>0&&(this.jumping=!0,s_jump=!0,player.yvel=-player.yspeed),player.x>k&&(player.x=0,C(ye)),player.x<0&&(player.x=k,C(pe)),player.y>z&&(player.y=0,C(Ae)),player.y<0&&(player.y=z,C(ge))},draw(e){te=Y,ee=j,d(166,0,19,36,this.x-this.radius|0,this.y-this.radius-12|0,this.facingLeft)},collides(){for(var e=-this.radius;e<this.radius;e++)for(var t=-this.radius;t<this.radius;t++){let n=fe[X+(this.b.x+e)+(this.b.y+t)*k];if(n==we||n==Ie||n==Re)return player.jumping=!1,!0}return!1},overlaps(){for(var e=-this.radius;e<this.radius;e++)for(var t=-this.radius;t<this.radius;t++){let n=fe[X+(this.b.x+e)+(this.b.y+t)*k];if(n)return{x:this.b.x+e,y:this.b.y+t,o:n}}return!1},updateB(){this.b={left:this.x-this.radius|0,right:this.x+this.radius|0,top:this.y-this.radius|0,bottom:this.y+this.radius|0,width:2*this.radius,height:2*this.radius,x:0|this.x,y:0|this.y}},collideResolutionY(e){let t=0,n=this.b;for(let e=n.left;e<=n.right;e++){let o=fe[X+e+k*n.bottom];if(o==we||o==Ie||o==Re)for(let o=n.bottom;o>=n.top;o--){let s=fe[X+e+k*o];s!=we&&s!=Ie&&s!=Re||(t=o-n.bottom-1)}}for(let e=n.left;e<=n.right;e++){let o=fe[X+e+k*n.top];if(o==we||o==Ie||o==Re)for(let o=n.top;o<=n.bottom;o++){let s=fe[X+e+k*o];s!=we&&s!=Ie&&s!=Re||(t=o-n.top+1)}}return t},collideResolutionX(e){let t=0,n=this.b;for(let e=n.top;e<=n.bottom;e++){let o=fe[X+n.left+k*e];if(o==we||o==Ie||o==Re)for(let o=n.x;o<=n.right;o++){let n=fe[X+o+k*e];n!=we&&n!=Ie&&n!=Re||t++}else{let o=fe[X+n.right+k*e];if(o==we||o==Ie||o==Re)for(let o=n.x;o>=n.left;o--){let n=fe[X+o+k*e];n!=we&&n!=Ie&&n!=Re||t--}}}return t},overlapResolution(e){let t=player.overlaps();switch(t.o){case Be:fe[X+t.x+t.y*k],ee=X,c(t.x,t.y,3,0),ee=j,splodes.push(new F(t.x,t.y)),fuelTimer+=.5}}},F.prototype.draw=function(){++this.size>this.maxSize||(this.filled?c(this.x,this.y,this.size,this.color):f(this.x,this.y,this.size,this.color),0==--this.counter&&(this.size++,this.counter=this.speed))},function(e=0,t=0,n=10,o=10,r=21,a=!1){this.x=e,this.y=t,this.maxSize=n,this.speed=10,this.counter=this.speed,this.color=r,this.size=1,this.filled=a,s=this}.prototype.draw=function(){++this.size>this.maxSize||(this.filled?c(this.x,this.y,this.size,this.color):f(this.x,this.y,this.size,this.color),0==--this.counter&&(this.size++,this.counter=this.speed))},states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(t){ee=0,e(0),T(["CRITICAL SYSTEM\nFAILURE",192,80,8,15,"center","top",3,27])}},states.menu={step:function(e){Key.justReleased(Key.p)&&(C(),state="game"),Key.justReleased(Key.r)&&(state="spritesheet")},render:function(n){ee=X,e(0),ee=0,e(0),ee=j,e(0),ee=O,e(0),ee=N,e(0),ee=X,T(["GREEBLE",k/2,150,20,20,"center","top",6,25]),ee=j,te=X,d(),ee=U,_e.setSeed(21);for(s=6e3;--s;){let e=_e.nextIntRange(0,k),t=_e.nextIntRange(0,z);fe[X+e+t*k]&&l(e+_e.nextIntRange(-2,2),t+_e.nextIntRange(-1,1),1,_e.nextIntRange(0,3),_e.nextIntRange(24,25))}_(U,O,25,20,23,18),ee=j,te=U,d(),te=O,d(),ee=U,_e.setSeed(20);for(var s=6e3;--s;){let e=_e.nextIntRange(0,k),t=_e.nextIntRange(0,z);fe[X+e+t*k]&&l(e+_e.nextIntRange(-1,1),t+_e.nextIntRange(0,1),_e.nextIntRange(1,5),1,_e.nextIntRange(22,24))}_(U,O,25,20,23,18),ee=j,te=U,d(),te=O,d(),player.draw(),te=Y;let r=8;for(;--r;)d(0,0,25,36,192+25*r,40);v(1,1,25,36,64,64,1,45),T(["PRESS P TO CONTINUE",k/2,230,2,2,"center","top",1,21]),ee=N;for(a=8e3;--a;)o((_e.nextIntRange(0,384)+10*t|0)%384,_e.nextIntRange(0,256),1);for(a=400;--a;)o((_e.nextIntRange(0,384)+20*t|0)%384,_e.nextIntRange(0,256),26);for(var a=100;--a;)o((_e.nextIntRange(0,384)+30*t|0)%384,_e.nextIntRange(0,256),21);_(j,N,15),te=j,d()}},states.game={step(e){Key.justReleased(Key.f)&&(state="gameover"),player.update(e),fuelTimer-=e,fuelTimer<0&&(fuelTimer=0,state="gameover")},render(t){if(ee=N,e(0),te=Q,d(),ee=j,e(0),S(),te=J,d(),player.draw(),te=Z,d(),ee=N,fuelTimer)if(fuelTimer>20)te=j,d(),te=P,d();else{ee=N,e(0);let t=1e3;for(;t--;)o(Math.random()*k,Math.random()*z,2);_(j,N,9)}else{ee=N,e(0);let t=2e3;for(;t--;){let e=Math.random()*k|0,t=Math.random()*z|0;f(e,t,1,fe[j+e+t*k]?27:0)}ee=N,T([fuelTimer.toString(),192,10,1,1,1,"center",1,9,0]),splodes.forEach(function(e){e.draw()})}}},states.loading={init:function(e){var t=new he.MusicGenerator(ce);t.createAudioBuffer(function(e){sounds.titleMusic=e,soundsLoaded++}),(t=new he.MusicGenerator(le)).createAudioBuffer(function(e){sounds.gameMusic=e,soundsLoaded++}),new he.SoundGenerator(ue).createAudioBuffer(147,function(e){ve.createBufferSource();sounds.jump=e,soundsLoaded++})},step:function(e){Key.justReleased(Key.z)&&(state="menu")},render:function(t){ee=N,e(0),T(soundsLoaded!=totalSounds?["LOADING...",k/2,128,2,2,"center","top",2,9]:["PRESS Z TO CONTINUE",k/2,128,2,2,"center","top",2,9])}},states.spritesheet={step:function(e){Key.justReleased(Key.x)&&(C(),state="menu")},render:function(s){for(ee=N,e(0),m(0,0,384,256,8,12,1),te=Y,d(),d(0,0,22,34,300,100),v(0,0,32,32,16,112,1,15+90*t),v(32,0,32,32,48,112,1,15+90*t),v(64,0,32,32,80,112,1,15+90*t),n=p=r=0;p<2e3;r%2||o(p%23,p/23|0,21),p++)p^n||(n=p+(63&[..."F0AL1314B2C2B16001177AeBSB1SB1R11AREàBDCCB5CAM6A51CBCB513333ZAQAÜAQFMEWB5DCCBC4IA515CC613333ZAFBIAKBO3BJFEBFEJBMAHAH3AFBGAGB5FAJBCA5O6BMBCA5IB5F4FAH3AGBH2HBH2IAG34G4LBIBHBIACC17K4N3ELAD1C1B1B7F7CB7GACDCEBACI13CA6AF13FBAF13BF3B7cCEANC11C0117CI0AP1ANEPILCGCIBKBGB1I1BE6BG6BDAC1312D2B2B2HAC12LADADALAIAN71AK5E1BD"].map(e=>["AAAAAA","AA","ACA","AE","AGA","DB","BB","AB"][e]||e).join("").charCodeAt(r++)));for(var r=0;r<32;r++)T([r.toString(),r<16?3+16*r:3+16*(r-16),r<16?200:216,1,1,1,"left",1,r,0])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>