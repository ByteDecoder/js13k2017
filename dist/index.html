<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:768px;height:512px;transform:translate(-50%,-30%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var Stats=function(){function e(e){return o.appendChild(e.dom),e}function t(e){for(var t=0;t<o.children.length;t++)o.children[t].style.display=t===e?"block":"none";n=e}var n=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(e){e.preventDefault(),t(++n%o.children.length)},!1);var r=(performance||Date).now(),a=r,s=0,i=e(new Stats.Panel("FPS","#0ff","#002")),f=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new Stats.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:o,addPanel:e,showPanel:t,begin:function(){r=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(f.update(e-r,200),e>a+1e3&&(i.update(1e3*s/(e-a),100),a=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:o,setMode:t}};Stats.Panel=function(e,t,n){var o=1/0,r=0,a=Math.round,s=a(window.devicePixelRatio||1),i=80*s,f=48*s,l=3*s,c=2*s,u=3*s,d=15*s,h=74*s,_=30*s,x=document.createElement("canvas");x.width=i,x.height=f,x.style.cssText="width:80px;height:48px";var v=x.getContext("2d");return v.font="bold "+9*s+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,i,f),v.fillStyle=t,v.fillText(e,l,c),v.fillRect(u,d,h,_),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(u,d,h,_),{dom:x,update:function(f,m){o=Math.min(o,f),r=Math.max(r,f),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,i,d),v.fillStyle=t,v.fillText(a(f)+" "+e+" ("+a(o)+"-"+a(r)+")",l,c),v.drawImage(x,u+s,d,h-s,_,u,d,h-s,_),v.fillRect(u+h-s,d,s,_),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(u+h-s,d,s,a((1-f/m)*_))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(e){return Math.sin(6.283184*e)}function n(e){return.00390625*Math.pow(1.059463094,e-128)}function o(e,t){setTimeout(function(){var n=new Uint8Array(e*E*2),o=n.length-2,r=function(){for(var e=new Date,a=0;o>=0;)if(n[o]=0,n[o+1]=128,o-=2,(a+=1)%1e3==0&&new Date-e>G)return void setTimeout(r,0);setTimeout(function(){t(n)},0)};setTimeout(r,0)},0)}function r(e,t,n,o,r){var a=n.fx_delay_time*o>>1,s=n.fx_delay_amt/255,i=0,f=function(){for(var n=new Date,o=0;i<t-a;){var l=4*i,c=4*(i+a),u=e[c]+(e[c+1]<<8)+(e[l+2]+(e[l+3]<<8)-32768)*s;if(e[c]=255&u,e[c+1]=u>>8&255,u=e[c+2]+(e[c+3]<<8)+(e[l]+(e[l+1]<<8)-32768)*s,e[c+2]=255&u,e[c+3]=u>>8&255,++i,(o+=1)%1e3==0&&new Date-n>G)return void setTimeout(f,0)}setTimeout(r,0)};setTimeout(f,0)}function a(){oe=V,re=V,h(8,10,17,9,8),h(7,11,19,7,8),h(9,12,15,5,2),h(11,14,2,1,16),h(21,14,2,1,16),c(12,15,13,15,21),c(22,15,23,15,21),c(17,9,17,6,5),f(17,6,21),h(42,17,3,1,5),h(40,19,7,7,5),h(41,23,5,5,0),d(139,28,5,13),h(74,22,2,5,8),d(75,28,3,8),u(75,28,1,5),m(107,19,114,27,117,23,8),v(V,O,23,21,31,23),re=O,p(),re=V,p(96,0,32,32,165,3),p(32,0,32,32,165,3),p(64,0,32,32,165,3),p(0,0,32,32,160,0)}function i(e){ue.fill(e,oe,oe+Y)}function f(e,t,n){t|=0,n|=0,(e|=0)>0&&e<j&&t>0&&t<U&&(ue[oe+t*j+e]=n)}function l(e,t,n=oe){return ue[n+e+t*j]}function c(e,t,n,o,r){var a,s,i=(o|=0)-(t|=0),l=(n|=0)-(e|=0);if(i<0?(i=-i,s=-1):s=1,l<0?(l=-l,a=-1):a=1,i<<=1,l<<=1,f(e,t,r),l>i)for(var c=i-(l>>1);e!=n;)c>=0&&(t+=s,c-=l),c+=i,f(e+=a,t,r);else for(c=l-(i>>1);t!=o;)c>=0&&(e+=a,c-=i),c+=l,f(e,t+=s,r)}function u(e,t,n,o){var r=-n,a=0,s=2-2*n;do{f(e-r,t+a,o),f(e-a,t-r,o),f(e+r,t-a,o),f(e+a,t+r,o),(n=s)<=a&&(s+=2*++a+1),(n>r||s>a)&&(s+=2*++r+1)}while(r<0)}function d(e,t,n,o){if(!(n<0)){e|=0,t|=0,o|=0;var r=-(n|=0),a=0,s=2-2*n;do{c(e-r,t-a,e+r,t-a,o),c(e-r,t+a,e+r,t+a,o),(n=s)<=a&&(s+=2*++a+1),(n>r||s>a)&&(s+=2*++r+1)}while(r<0)}}function h(e,t,n,o,r){x1=0|e,y1=0|t,x2=e+n|0,y2=t+o|0;var a=Math.abs(y2-y1);if(c(x1,y1,x2,y1,r),a>0)for(;--a;)c(x1,y1+a,x2,y1+a,r);c(x1,y2,x2,y2,r)}function _(e,t,n,o,r,a){for(let s=0;s<=r;s++)h(e+s,t-s,n-2*s,o+2*s,a)}function v(e,t,n,o=n,r=n,a=n){for(let s=0;s<=j;s++)for(let i=0;i<=U;i++){let f=s-1+i*j,l=s+1+i*j,c=s+(i+1)*j,u=s+(i-1)*j;ue[e+(s+i*j)]&&(ue[e+f]||(ue[t+f]=n),ue[e+l]||(ue[t+l]=r),ue[e+u]||(ue[t+u]=o),ue[e+c]||(ue[t+c]=a))}}function m(e,t,n,o,r,a,s){var i=j,e=Math.round(16*e),n=Math.round(16*n),r=Math.round(16*r),t=Math.round(16*t),f=e-n,l=(o=Math.round(16*o))-t,c=n-r,u=(a=Math.round(16*a))-o,d=r-e,h=t-a,_=Math.max(Math.min(e,n,r)+15>>4,0),x=Math.min(Math.max(e,n,r)+15>>4,j),v=Math.max(Math.min(t,o,a)+15>>4,0),m=Math.min(Math.max(t,o,a)+15>>4,U);_&=-8,v&=-8;var p=-l*e-f*t,y=-u*n-c*o,g=-h*r-d*a;(l>0||0==l&&f>0)&&p++,(u>0||0==u&&c>0)&&y++,(h>0||0==h&&d>0)&&g++,p=p-1>>4,y=y-1>>4,g=g-1>>4;var w=0,R=0,I=0,S=0,M=0,b=0;f>=0?R-=7*f:w-=7*f,l>=0?R-=7*l:w-=7*l,c>=0?S-=7*c:I-=7*c,u>=0?S-=7*u:I-=7*u,d>=0?b-=7*d:M-=7*d,h>=0?b-=7*h:M-=7*h;for(var T=i-8,q=v;q<m;q+=8)for(var D=_;D<x;D+=8){var A=p+f*q+l*D,k=y+c*q+u*D,K=g+d*q+h*D;if(!(A<R||k<S||K<b)){var L=D+q*i;if(A>=w&&k>=I&&K>=M)for(B=0;B<8;B++){for(C=0;C<8;C++,L++)ue[oe+L]=s;L+=T}else for(var B=0;B<8;B++){for(var E=A,G=k,z=K,C=0;C<8;C++)(E|G|z)>=0&&(ue[oe+L]=s),E+=l,G+=u,z+=h,L++;A+=f,k+=c,K+=d,L+=T}}}}function p(e=0,t=0,n=384,o=256,r=0,a=0,s=!1,i=!1){for(var f=0;f<o;f++)for(var l=0;l<n;l++)a+f<U&&r+l<j&&a+f>-1&&r+l>-1&&(s&i?ue[re+((t+(o-f))*j+e+(n-l))]>0&&(ue[oe+((a+f)*j+r+l)]=se[ue[re+((t+(o-f))*j+e+(n-l))]]):i&&!s?ue[re+((t+(o-f))*j+e+l)]>0&&(ue[oe+((a+f)*j+r+l)]=ue[re+((t+(o-f))*j+e+l)]):s&&!i?ue[re+((t+f)*j+e+(n-l))]>0&&(ue[oe+((a+f)*j+r+l)]=ue[re+((t+f)*j+e+(n-l))]):s||i||ue[re+((t+f)*j+e+l)]>0&&(ue[oe+((a+f)*j+r+l)]=se[ue[re+((t+f)*j+e+l)]]))}function g(e,t,n,o,r,a,s,i){i*=.0174533;let f=e+n/2|0,l=t+o/2|0,c=n*s/2*1.41421356237|5,u=o*s/2*1.41421356237|5,d=-c,h=c,_=-u,x=u,v=1/s,m=Math.cos(-i)*v,p=Math.sin(-i)*v;for(let e=_;e<x;e++)for(let t=d;t<h;t++){let s=f+Math.round(m*t+p*e),i=l+Math.round(-p*t+m*e),c=t+r|0,u=e+a|0;s>=0&&i>=0&&s<n&&i<o&&ue[re+(i*j+s)]>0&&(ue[oe+(u*j+c)]=ue[re+(i*j+s)])}}function w(e,t,n,o,r,a,s){r=r||8,n/=a=a||8,o/=r;for(var i=0;i<r;++i)for(var f=0,l=a/2;f<l;++f)h(e+(2*f*n+(i%2?0:n)),i*o,n-1,o-1,s)}function R(e,t=1,n=0,o=!1){var r=z.createBufferSource(),a=z.createGain(),s=z.createStereoPanner();return r.buffer=e,r.connect(s),s.connect(a),a.connect(z.destination),r.playbackRate.value=t,r.loop=o,a.gain.value=1,s.pan.value=n,r.start(),{volume:a,sound:r}}function I(){for(var e=Y;e--;)ce[e]=ae[se[ue[e]]];ie.data.set(le),ne.putImageData(ie,0,0)}function S(e){switch(oe=W,i(0),oe=H,i(0),oe=J,i(0),oe=Q,i(0),oe=Z,i(0),oe=O,i(0),e){case de:currentRoom[0]--,currentRoom[0]<0&&(currentRoom[0]=pe),console.log(currentRoom);break;case he:currentRoom[0]++,currentRoom[0]>pe&&(currentRoom[0]=0),console.log(currentRoom);break;case _e:currentRoom[1]--,currentRoom[1]<0&&(currentRoom[1]=ye),console.log(currentRoom);break;case xe:currentRoom[1]++,currentRoom[1]>ye&&(currentRoom[1]=0),console.log(currentRoom)}oe=W,rooms[world[currentRoom[1]*(pe+1)+currentRoom[0]]].draw()}function M(){oe=$,i(0);let e=5e3;for(;--e;)f(L.nextIntRange(0,384),L.nextIntRange(0,256),1);for(e=200;--e;)f(L.nextIntRange(0,384),L.nextIntRange(0,256),26);for(e=60;--e;)f(L.nextIntRange(0,384),L.nextIntRange(0,256),20);for(e=20;--e;)f(L.nextIntRange(0,384),L.nextIntRange(0,256),21);for(e=3;--e;)d(L.nextIntRange(0,384),L.nextIntRange(0,256),L.nextIntRange(2,5),L.nextIntRange(16,19))}function b(){let e=Y;for(;--e;)if(ue[W+e]==me){let t=e/j|0,n=e%j;d(n,t,3,9),u(n,t,3,11)}}function T(){re=W,oe=H,i(0);e=3e3;for(L.setSeed(1019);--e;){let e=L.nextIntRange(0,j),t=L.nextIntRange(0,U);l(e,t,W)==ve&&_(e+L.nextIntRange(-5,0),t+L.nextIntRange(-10,0),L.nextIntRange(0,15),L.nextIntRange(0,10),1,L.nextIntRange(22,24))}oe=J,i(0),v(H,J,25,20,26,2),oe=Z,re=H,p(),re=J,p(),oe=H,i(0);var e=3e3;for(L.setSeed(1019);--e;){let e=L.nextIntRange(0,j),t=L.nextIntRange(0,U);ue[W+e+t*j]==ve&&_(e+L.nextIntRange(-5,0),t+L.nextIntRange(-10,0),L.nextIntRange(0,15),L.nextIntRange(0,10),1,L.nextIntRange(22,24))}oe=J,i(0),v(H,J,25,20,26,2),oe=Z,re=H,p(),re=J,p()}function q(){oe=H,i(0);var e=1e3;for(L.setSeed(1019);--e;){let e=L.nextIntRange(0,j),t=L.nextIntRange(0,U);ue[W+e+t*j]==ve&&(h(e+L.nextIntRange(-5,0),t+L.nextIntRange(-20,0),L.nextIntRange(0,5),L.nextIntRange(0,20),L.nextIntRange(22,24)),d(e,t-10,2,L.nextIntRange(22,24)))}oe=J,i(0),v(H,J,25,20,26,2),oe=Q,re=H,p(),re=J,p()}function D(e=0,t=0,n=10,o=10,r=21,a=!1){this.x=e,this.y=t,this.maxSize=n,this.speed=10,this.counter=this.speed,this.color=r,this.size=1,this.filled=a,s=this}function A(e){for(var t=e[0].length,n=0;n<t;n++){var o=[];o=K(e[0].charAt(n));for(var r=0;r<5;r++)for(var a=0;a<5;a++)1==o[5*r+a]&&(1==e[4]?f(e[1]+a*e[4]+(5*e[4]+e[3])*n,e[2]+r*e[4],e[5]):h(e[1]+a*e[4]+(5*e[4]+e[3])*n,e[2]+r*e[4],e[4],e[4],e[5]))}}function k(e){var t=5*e[7],n=e[0].split("\n"),o=n.slice(0),r=n.length,a=o.sort(function(e,t){return t.length-e.length})[0],s=a.length*t+(a.length-1)*e[3],i=r*t+(r-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var f=e[1],l=e[2],c=e[1]+s,u=e[2]+i;"center"==e[5]?(f=e[1]-s/2,c=e[1]+s/2):"right"==e[5]&&(f=e[1]-s,c=e[1]),"center"==e[6]?(l=e[2]-i/2,u=e[2]+i/2):"bottom"==e[6]&&(l=e[2]-i,u=e[2]);for(var d=f+s/2,h=l+i/2,_=0;_<r;_++){var x=n[_],v=x.length*t+(x.length-1)*e[3],m=e[1],p=e[2]+(t+e[4])*_;"center"==e[5]?m=e[1]-v/2:"right"==e[5]&&(m=e[1]-v),"center"==e[6]?p-=i/2:"bottom"==e[6]&&(p-=i),A([x,m,p,e[3]||0,e[7]||1,e[8],e[9]])}return{sx:f,sy:l,cx:d,cy:h,ex:c,ey:u,width:s,height:i}}function K(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}var L={seed:Date.now(),a:1664525,c:1013904223,m:Math.pow(2,32),setSeed:function(e){this.seed=e},nextInt:function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},nextFloat:function(){return this.nextInt()/this.m},nextBool:function(e){return null==e&&(e=.5),this.nextFloat()<e},nextFloatRange:function(e,t){return e+this.nextFloat()*(t-e)},nextIntRange:function(e,t){return Math.floor(this.nextFloatRange(e,t))},nextColor:function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();e.length<6;)e="0"+e;return"#"+e}},B={},E=2,G=33,z=null,C=[e,function(t){return e(t)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];B.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/E/2},B.AudioGenerator.prototype.getAudioBuffer=function(e){null===z&&(z=new AudioContext);var t=this.mixBuf,n=this.waveSize*E*2,o=z.createBuffer(E,this.waveSize,44100),r=o.getChannelData(0),a=o.getChannelData(1),s=0,i=function(){for(var f=new Date,l=0;s<n/2;){var c=4*(t[4*s]+(t[4*s+1]<<8)-32768);if(c=c<-32768?-32768:c>32767?32767:c,r[s]=c/32768,c=4*(t[4*s+2]+(t[4*s+3]<<8)-32768),c=c<-32768?-32768:c>32767?32767:c,a[s]=c/32768,s+=1,(l+=1)%1e3==0&&new Date-f>G)return void setTimeout(i,0)}setTimeout(function(){e(o)},0)};setTimeout(i,0)},B.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=C[e.lfo_waveform],this.osc1=C[e.osc1_waveform],this.osc2=C[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},B.SoundGenerator.prototype.genSound=function(t,o,r){new Date;for(var a=0,s=0,i=n(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),f=n(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,c=0,u=0,d=this.attack+this.sustain+this.release-1;d>=0;--d){var h=d+r,_=this.osc_lfo(h*this.lfoFreq)*this.instr.lfo_amt/512+.5,x=1;d<this.attack?x=d/this.attack:d>=this.attack+this.sustain&&(x-=(d-this.attack-this.sustain)/this.release);var v=i;this.instr.lfo_osc1_freq&&(v+=_),this.instr.osc1_xenv&&(v*=x*x),a+=v;var m=this.osc1(a)*this.instr.osc1_vol;v=f,this.instr.osc2_xenv&&(v*=x*x),s+=v,m+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*x),m*=x/255;var p=this.instr.fx_freq;this.instr.lfo_fx_freq&&(p*=_);var y=l*(m-u)-(c+=(p=1.5*Math.sin(3.141592*p/44100))*u);switch(u+=p*y,this.instr.fx_filter){case 1:m=y;break;case 2:m=c;break;case 3:m=u;break;case 4:m=c+y}if(v=e(h*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(h*=4)+3<o.length){var g=o[h]+(o[h+1]<<8)+m*(1-v);o[h]=255&g,o[h+1]=g>>8&255,g=o[h+2]+(o[h+3]<<8)+m*v,o[h+2]=255&g,o[h+3]=g>>8&255}}},B.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,a=this;o(n,function(o){a.genSound(e,o,0),r(o,n,a.instr,a.rowLen,function(){t(new B.AudioGenerator(o))})})},B.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},B.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},B.MusicGenerator.prototype.generateTrack=function(e,t,n){var a=this;o(this.waveSize,function(o){var s=a.waveSize,i=a.waveSize*E*2,f=a.song.rowLen,l=a.song.endPattern,c=new B.SoundGenerator(e,f),u=0,d=0,h=0,_=function(){for(var t=new Date;;)if(32!==h){if(d===l-1)return void setTimeout(x,0);var n=e.p[d];if(n){var r=e.c[n-1].n[h];r&&c.genSound(r,o,u)}if(u+=f,h+=1,new Date-t>G)return void setTimeout(_,0)}else h=0,d+=1},x=function(){r(o,s,e,f,m)},v=0,m=function(){for(var e=new Date,r=0;v<i;){var a=t[v]+(t[v+1]<<8)+o[v]+(o[v+1]<<8)-32768;if(t[v]=255&a,t[v+1]=a>>8&255,v+=2,(r+=1)%1e3==0&&new Date-e>G)return void setTimeout(m,0)}setTimeout(n,0)};setTimeout(_,0)})},B.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;o(this.waveSize,function(n){var o=0,r=function(){o<t.song.songData.length?(o+=1,t.generateTrack(t.song.songData[o-1],n,r)):e(new B.AudioGenerator(n))};r()})},B.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})};var P={rowLen:5513,endPattern:17,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:128,osc1_waveform:2,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:142,osc2_waveform:3,noise_fader:0,env_attack:137,env_sustain:2653,env_release:1979,env_master:155,fx_filter:3,fx_freq:1052,fx_resonance:154,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:8,fx_pan_amt:144,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[2,2,3,3,2,2,3,3,2,2,3,3,2,2,3,3],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[171,166,169,171,174,171,169,171,0,166,169,171,174,171,169,171,171,166,169,171,174,171,169,171,0,166,169,171,174,171,169,171]},{n:[169,164,167,169,172,169,167,169,0,164,167,169,172,169,167,169,169,164,167,169,172,169,167,169,0,164,167,169,172,169,167,169]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:116,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:8,osc2_xenv:0,osc2_vol:255,osc2_waveform:2,noise_fader:0,env_attack:351,env_sustain:4611,env_release:1403,env_master:199,fx_filter:2,fx_freq:200,fx_resonance:254,fx_delay_time:5,fx_delay_amt:12,fx_pan_freq:0,fx_pan_amt:214,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:87,lfo_waveform:3,p:[1,1,2,2,1,1,2,2,1,1,2,2,1,1,2,2],c:[{n:[123,0,0,121,0,0,123,0,0,0,0,0,0,0,121,0,123,0,0,121,0,0,123,0,0,0,0,0,0,0,0,0]},{n:[121,0,0,119,0,0,121,0,0,0,0,0,0,0,119,0,121,0,0,119,0,0,121,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:162,osc1_waveform:0,osc2_oct:6,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:162,osc2_waveform:0,noise_fader:14,env_attack:50,env_sustain:150,env_release:8181,env_master:161,fx_filter:2,fx_freq:5900,fx_resonance:240,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[123,0,0,123,0,0,0,123,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:29,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:2,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[0,123,123,123,0,123,123,123,0,123,0,123,0,123,123,123,0,123,123,123,0,123,0,123,0,123,123,123,0,123,123,123]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:197,env_sustain:13163,env_release:10614,env_master:180,fx_filter:2,fx_freq:1792,fx_resonance:136,fx_delay_time:6,fx_delay_amt:81,fx_pan_freq:3,fx_pan_amt:151,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,3,4,5,2,3,4,5,2,3,4,5,2,3,4],c:[{n:[162,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,171,0,0,0,0,0,0,0,166,0,0,0,0,0,0,0]},{n:[164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,162,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,169,0,0,0,0,0,0,0,0,0,0,0,167,0,0,0]},{n:[166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,0,0,0,0,0,0,0,0,0,0,167,0,0,0]}]}],songLen:69},F={osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:117,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:155,osc2_waveform:2,noise_fader:0,env_attack:7105,env_sustain:0,env_release:444,env_master:192,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:16,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:59,lfo_waveform:0};fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";const j=384,U=256,Y=j*U,N=0,O=Y,X=2*Y,H=3*Y,J=4*Y,V=5*Y,W=6*Y,Z=7*Y,Q=8*Y,$=9*Y,ee=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];var te=document.getElementById("canvas"),ne=te.getContext("2d"),oe=0,re=Y,ae=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],se=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];paldrk=[0,0,1,2,3,4,5,6,6,10,11,12,13,14,2,2,15,16,17,18,22,20,23,24,25,26,2,2,27,28,31,13],ne.imageSmoothingEnabled=!1,ne.mozImageSmoothingEnabled=!1,te.width=j,te.height=U;var ie=ne.getImageData(0,0,j,U),fe=new ArrayBuffer(ie.data.length),le=new Uint8Array(fe),ce=new Uint32Array(fe),ue=new Uint8ClampedArray(j*U*10);Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)};const de=1,he=2,_e=3,xe=4,ve=21,me=8;states={},init=(()=>{sounds={},soundsLoaded=0,totalSounds=2,score=0,fuelTimer=30,parts=0,last=0,dt=0,now=0,t=0,state="loading",splodes=[],paused=!1,transition=!1,s_titleSong=!1,s_jump=!1,z=new AudioContext,a(),states.loading.init(),player.init(),stats=new Stats,document.body.appendChild(stats.dom),loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{if(stats.begin(),paused)se=paldrk,k(["PAUSED",192,128,1,1,1,"center",1,21,0]);else{se=ee;let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3),t+=dt,states[state].step(dt),last=e,states[state].render()}I(),stats.end(),requestAnimationFrame(loop)}),world=[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,7,6,6,8,6,6,6];const pe=9,ye=5;currentRoom=[0,1],rooms=[{draw:function(e){M(),T(),q()}},{draw:function(e){d(192,128,50,ve),M(),T(),q()}},{draw:function(e){u(192,128,64,ve),M(),T(),q()}},{draw:function(e){h(0,0,127,256,ve),h(250,0,127,256,ve),M(),T(),q()}},{draw:function(e){h(0,0,127,256,ve),h(250,0,127,256,ve),M(),T(),q()}},{draw:function(e){}},{draw:function(e){h(0,205,384,100,ve);let t=100;for(;--t;)x=L.nextIntRange(0,j),y=L.nextIntRange(100,200),f(x,y,me);M(),T(),q()}},{draw:function(e){m(0,256,384,256,182,205,ve),h(100,70,20,80,ve),h(100,140,100,20,ve),h(200,820,10,100,ve),h(210,70,100,100,ve),M(),T(),q()}},{draw:function(e){h(0,205,384,10,ve),d(250,150,64,ve),f(50,180,me),M(),T(),q()}}],player={init(){this.x=192,this.y=30,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=200,this.yspeed=200,this.drag=.8,this.gravity=8,this.maxYvel=400,this.maxXvel=400,this.minYvel=-400,this.minXvel=-400,this.b={},this.facingLeft=!1,this.jumping=!1},update(e){this.updateB(),this.oldX=this.x,this.oldY=this.y,this.xvel*=player.drag,this.yvel+=player.gravity,this.yvel=this.yvel.clamp(this.minYvel,this.maxYvel),this.xvel=this.xvel.clamp(this.minXvel,this.maxXvel);let t=e*player.xvel,n=e*player.yvel;player.x+=t,this.updateB(),this.collides()&&(player.x=player.oldX,player.xvel=.4*-player.xvel),player.y+=n,this.updateB(),this.collides()&&(player.y=player.oldY,player.yvel=.4*-player.yvel),this.updateB(),this.collides()&&(this.x+=this.collideResolutionX(),this.updateB(),this.collides()&&(this.y+=this.collideResolutionY(),this.updateB())),this.overlapResolution(),this.updateB(),(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(player.facingLeft=!1,player.xvel=player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(this.facingLeft=!0,player.xvel=-player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&!this.jumping&&fuelTimer>0&&(player.yvel=-player.yspeed),player.x>j&&(player.x=0,S(he)),player.x<0&&(player.x=j,S(de)),player.y>U&&(player.y=0,S(xe)),player.y<0&&(player.y=U,S(_e))},draw(e){re=V,oe=O,p(0,0,19,34,this.x-this.radius|0,this.y-this.radius-12|0,this.facingLeft)},collides(){for(var e=-this.radius;e<this.radius;e++)for(var t=-this.radius;t<this.radius;t++)if(ue[W+(this.b.x+e)+(this.b.y+t)*j]==ve)return!0;return!1},overlaps(){for(var e=-this.radius;e<this.radius;e++)for(var t=-this.radius;t<this.radius;t++){let n=ue[W+(this.b.x+e)+(this.b.y+t)*j];if(n)return{x:this.b.x+e,y:this.b.y+t,o:n}}return!1},updateB(){this.b={left:this.x-this.radius|0,right:this.x+this.radius|0,top:this.y-this.radius|0,bottom:this.y+this.radius|0,width:2*this.radius,height:2*this.radius,x:0|this.x,y:0|this.y}},collideResolutionY(e){let t=0,n=this.b;for(let e=n.left;e<=n.right;e++)if(ue[W+e+j*n.bottom]==ve)for(let o=n.bottom;o>=n.top;o--)ue[W+e+j*o]==ve&&(t=o-n.bottom-1);for(let e=n.left;e<=n.right;e++)if(ue[W+e+j*n.top]==ve)for(let o=n.top;o<=n.bottom;o++)ue[W+e+j*o]==ve&&(t=o-n.top+1);return t},collideResolutionX(e){let t=0,n=this.b;for(let e=n.top;e<=n.bottom;e++)if(ue[W+n.left+j*e]==ve)for(let o=n.x;o<=n.right;o++)ue[W+o+j*e]==ve&&t++;else if(ue[W+n.right+j*e]==ve)for(let o=n.x;o>=n.left;o--)ue[W+o+j*e]==ve&&t--;for(let e=n.top+2;e<=n.bottom-2;e++)if(ue[W+n.right+j*e])for(let o=n.left;o<=n.right;o++)ue[W+o+j*e]&&(t=30);return t},overlapResolution(e){let t=player.overlaps();switch(t.o){case me:ue[W+t.x+t.y*j],oe=W,d(t.x,t.y,3,0),oe=O,splodes.push(new D(t.x,t.y)),fuelTimer+=1,R(sounds.jump)}}},D.prototype.draw=function(){++this.size>this.maxSize||(this.filled?d(this.x,this.y,this.size,this.color):u(this.x,this.y,this.size,this.color),0==--this.counter&&(this.size++,this.counter=this.speed))},states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(e){oe=0,i(0),k(["CRITICAL SYSTEM\nFAILURE",192,80,8,15,"center","top",3,27])}},states.menu={step:function(e){s_titleSong||(titleSong=R(sounds.titleMusic,1,0,!0),s_titleSong=!0),Key.justReleased(Key.p)&&(S(),state="game",titleSong.sound.stop()),Key.justReleased(Key.x)&&(state="spritesheet")},render:function(e){oe=W,i(0),oe=0,i(0),oe=O,i(0),oe=H,i(0),oe=N,i(0),oe=W,k(["GREEBLE",j/2,150,20,20,"center","top",6,25]),oe=O,re=W,p(),oe=J,L.setSeed(21);for(n=6e3;--n;){let e=L.nextIntRange(0,j),t=L.nextIntRange(0,U);ue[W+e+t*j]&&h(e+L.nextIntRange(-2,2),t+L.nextIntRange(-1,1),1,L.nextIntRange(0,3),L.nextIntRange(24,25))}v(J,H,25,20,23,18),oe=O,re=J,p(),re=H,p(),oe=J,L.setSeed(20);for(var n=6e3;--n;){let e=L.nextIntRange(0,j),t=L.nextIntRange(0,U);ue[W+e+t*j]&&h(e+L.nextIntRange(-1,1),t+L.nextIntRange(0,1),L.nextIntRange(1,5),1,L.nextIntRange(22,24))}v(J,H,25,20,23,18),oe=O,re=J,p(),re=H,p(),player.draw(),re=V;let o=8;for(;--o;)p(0,0,25,36,192+25*o,40);g(1,1,25,36,64,64,1,45),k(["PRESS P TO CONTINUE",j/2,230,2,2,"center","top",1,21]),oe=N;for(r=8e3;--r;)f((L.nextIntRange(0,384)+10*t|0)%384,L.nextIntRange(0,256),1);for(r=400;--r;)f((L.nextIntRange(0,384)+20*t|0)%384,L.nextIntRange(0,256),26);for(var r=100;--r;)f((L.nextIntRange(0,384)+30*t|0)%384,L.nextIntRange(0,256),21);v(O,N,15),re=O,p()}},states.game={step(e){Key.justReleased(Key.f)&&(state="gameover"),player.update(e),fuelTimer-=e,fuelTimer<0&&(fuelTimer=0)},render(e){if(oe=N,i(0),re=$,p(),oe=O,i(0),b(),re=Z,p(),player.draw(),re=Q,p(),oe=N,fuelTimer)if(fuelTimer>20)re=O,p(),re=X,p();else{oe=N,i(0);let e=1e3;for(;e--;)f(Math.random()*j,Math.random()*U,2);v(O,N,9)}else{oe=N,i(0);let e=2e3;for(;e--;){let e=Math.random()*j|0,t=Math.random()*U|0;u(e,t,1,ue[O+e+t*j]?27:0)}}k([fuelTimer.toString(),192,10,1,1,1,"center",1,9,0]),splodes.forEach(function(e){e.draw()})}},states.loading={init:function(e){new B.MusicGenerator(P).createAudioBuffer(function(e){sounds.titleMusic=e,soundsLoaded++}),new B.SoundGenerator(F).createAudioBuffer(147,function(e){z.createBufferSource();sounds.jump=e,soundsLoaded++})},step:function(e){Key.justReleased(Key.z)&&(state="menu")},render:function(e){oe=N,i(0),k(soundsLoaded!=totalSounds?["LOADING...",j/2,128,2,2,"center","top",2,9]:["PRESS Z TO CONTINUE",j/2,128,2,2,"center","top",2,9])}},states.spritesheet={step:function(e){Key.justReleased(Key.x)&&(S(),state="menu")},render:function(e){oe=N,i(0),w(0,0,384,256,8,12,1),re=V,p(),p(0,0,22,34,300,100),g(0,0,32,32,16,112,1,15+90*t),g(32,0,32,32,48,112,1,15+90*t),g(64,0,32,32,80,112,1,15+90*t);for(var n=0;n<32;n++)k([n.toString(),n<16?3+16*n:3+16*(n-16),n<16?200:216,1,1,1,"left",1,n,0])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>