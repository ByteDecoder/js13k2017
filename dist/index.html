<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:150vmin;height:100vmin;transform:translate(-50%,-25%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
!function(){function e(e){return Math.sin(6.283184*e)}function o(e){return.00390625*Math.pow(1.059463094,e-128)}function n(e,t){setTimeout(function(){var o=new Uint8Array(e*d*2),n=o.length-2,s=function(){for(var e=new Date,_=0;n>=0;)if(o[n]=0,o[n+1]=128,n-=2,(_+=1)%1e3==0&&new Date-e>x)return void setTimeout(s,0);setTimeout(function(){t(o)},0)};setTimeout(s,0)},0)}function s(e,t,o,n,s){var _=o.fx_delay_time*n>>1,f=o.fx_delay_amt/255,r=0,a=function(){for(var o=new Date,n=0;r<t-_;){var c=4*r,i=4*(r+_),v=e[i]+(e[i+1]<<8)+(e[c+2]+(e[c+3]<<8)-32768)*f;if(e[i]=255&v,e[i+1]=v>>8&255,v=e[i+2]+(e[i+3]<<8)+(e[c]+(e[c+1]<<8)-32768)*f,e[i+2]=255&v,e[i+3]=v>>8&255,++r,(n+=1)%1e3==0&&new Date-o>x)return void setTimeout(a,0)}setTimeout(s,0)};setTimeout(a,0)}function _(e){k.fill(e,renderTarget,renderTarget+131072)}function f(e,t,o){t|=0,o|=0,(e|=0)>0&&e<p&&t>0&&t<y&&(k[renderTarget+(t*p+e)]=o)}function r(e,t,o,n,s){var _,r,a=(n|=0)-(t|=0),c=(o|=0)-(e|=0);if(a<0?(a=-a,r=-1):r=1,c<0?(c=-c,_=-1):_=1,a<<=1,c<<=1,f(e,t,s),c>a)for(var i=a-(c>>1);e!=o;)i>=0&&(t+=r,i-=c),i+=a,f(e+=_,t,s);else for(i=c-(a>>1);t!=n;)i>=0&&(e+=_,i-=a),i+=c,f(e,t+=r,s)}function a(e,t,o,n,s){x1=0|e,y1=0|t,x2=e+o|0,y2=t+n|0;var _=Math.abs(y2-y1);if(r(x1,y1,x2,y1,s),_>0)for(;--_;)r(x1,y1+_,x2,y1+_,s);r(x1,y2,x2,y2,s)}function c(){for(var e=131072;e--;)D[e]=colors[pal[k[e]]];T.data.set(g),ctx.putImageData(T,0,0)}function i(e){for(var t=e[0].length,o=0;o<t;o++){var n=[];n=u(e[0].charAt(o));for(var s=0;s<5;s++)for(var _=0;_<5;_++)1==n[5*s+_]&&(1==e[4]?f(e[1]+_*e[4]+(5*e[4]+e[3])*o,e[2]+s*e[4],e[5]):a(e[1]+_*e[4]+(5*e[4]+e[3])*o,e[2]+s*e[4],e[4],e[4],e[5]))}}function v(e){var t=5*e[7],o=e[0].split("\n"),n=o.slice(0),s=o.length,_=n.sort(function(e,t){return t.length-e.length})[0],f=_.length*t+(_.length-1)*e[3],r=s*t+(s-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var a=e[1],c=e[2],v=e[1]+f,u=e[2]+r;"center"==e[5]?(a=e[1]-f/2,v=e[1]+f/2):"right"==e[5]&&(a=e[1]-f,v=e[1]),"center"==e[6]?(c=e[2]-r/2,u=e[2]+r/2):"bottom"==e[6]&&(c=e[2]-r,u=e[2]);for(var l=a+f/2,d=c+r/2,x=0;x<s;x++){var h=o[x],m=h.length*t+(h.length-1)*e[3],w=e[1],p=e[2]+(t+e[4])*x;"center"==e[5]?w=e[1]-m/2:"right"==e[5]&&(w=e[1]-m),"center"==e[6]?p-=r/2:"bottom"==e[6]&&(p-=r),i([h,w,p,e[3]||0,e[7]||1,e[8],e[9]])}return{sx:a,sy:c,cx:l,cy:d,ex:v,ey:u,width:f,height:r}}function u(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}var l={},d=2,x=33,h=null,m=[e,function(t){return e(t)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];l.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/d/2},l.AudioGenerator.prototype.getAudioBuffer=function(e){null===h&&(h=new AudioContext);var t=this.mixBuf,o=this.waveSize*d*2,n=h.createBuffer(d,this.waveSize,44100),s=n.getChannelData(0),_=n.getChannelData(1),f=0,r=function(){for(var a=new Date,c=0;f<o/2;){var i=4*(t[4*f]+(t[4*f+1]<<8)-32768);if(i=i<-32768?-32768:i>32767?32767:i,s[f]=i/32768,i=4*(t[4*f+2]+(t[4*f+3]<<8)-32768),i=i<-32768?-32768:i>32767?32767:i,_[f]=i/32768,f+=1,(c+=1)%1e3==0&&new Date-a>x)return void setTimeout(r,0)}setTimeout(function(){e(n)},0)};setTimeout(r,0)},l.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=m[e.lfo_waveform],this.osc1=m[e.osc1_waveform],this.osc2=m[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},l.SoundGenerator.prototype.genSound=function(t,n,s){new Date;for(var _=0,f=0,r=o(t+12*(this.instr.e-8)+this.instr.t)*(1+8e-4*this.instr.o),a=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),c=this.instr.fx_resonance/255,i=0,v=0,u=this.attack+this.sustain+this.release-1;u>=0;--u){var l=u+s,d=this.osc_lfo(l*this.lfoFreq)*this.instr.lfo_amt/512+.5,x=1;u<this.attack?x=u/this.attack:u>=this.attack+this.sustain&&(x-=(u-this.attack-this.sustain)/this.release);var h=r;this.instr.lfo_osc1_freq&&(h+=d),this.instr.osc1_xenv&&(h*=x*x),_+=h;var m=this.osc1(_)*this.instr.osc1_vol;h=a,this.instr.osc2_xenv&&(h*=x*x),f+=h,m+=this.osc2(f)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*x),m*=x/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=d);var p=c*(m-v)-(i+=(w=1.5*Math.sin(3.141592*w/44100))*v);switch(v+=w*p,this.instr.fx_filter){case 1:m=p;break;case 2:m=i;break;case 3:m=v;break;case 4:m=i+p}if(h=e(l*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(l*=4)+3<n.length){var y=n[l]+(n[l+1]<<8)+m*(1-h);n[l]=255&y,n[l+1]=y>>8&255,y=n[l+2]+(n[l+3]<<8)+m*h,n[l+2]=255&y,n[l+3]=y>>8&255}}},l.SoundGenerator.prototype._=function(e,t){var o=this.attack+this.sustain+this.release-1+32*this.rowLen,_=this;n(o,function(n){_.genSound(e,n,0),s(n,o,_.instr,_.rowLen,function(){t(new l.AudioGenerator(n))})})},l.SoundGenerator.prototype.createAudioBuffer=function(e,t){this._(e,function(e){e.getAudioBuffer(t)})},l.i=function(e){this.song=e,this.waveSize=44100*e.songLen},l.i.prototype.generateTrack=function(e,t,o){var _=this;n(this.waveSize,function(n){var f=_.waveSize,r=_.waveSize*d*2,a=_.song.rowLen,c=_.song.endPattern,i=new l.SoundGenerator(e,a),v=0,u=0,h=0,m=function(){for(var t=new Date;;)if(32!==h){if(u===c-1)return void setTimeout(w,0);var o=e.p[u];if(o){var s=e.c[o-1].n[h];s&&i.genSound(s,n,v)}if(v+=a,h+=1,new Date-t>x)return void setTimeout(m,0)}else h=0,u+=1},w=function(){s(n,f,e,a,y)},p=0,y=function(){for(var e=new Date,s=0;p<r;){var _=t[p]+(t[p+1]<<8)+n[p]+(n[p+1]<<8)-32768;if(t[p]=255&_,t[p+1]=_>>8&255,p+=2,(s+=1)%1e3==0&&new Date-e>x)return void setTimeout(y,0)}setTimeout(o,0)};setTimeout(m,0)})},l.i.prototype._=function(e){var t=this;n(this.waveSize,function(o){var n=0,s=function(){n<t.song.songData.length?(n+=1,t.generateTrack(t.song.songData[n-1],o,s)):e(new l.AudioGenerator(o))};s()})},l.i.prototype.createAudioBuffer=function(e){this._(function(t){t.getAudioBuffer(e)})};var w={songLen:37,songData:[{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{e:8,t:0,o:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]}]},{e:7,t:0,o:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]}]},{e:7,t:0,o:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]}]},{e:8,t:0,o:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9};const p=384,y=256;var q=document.getElementById("canvas");ctx=q.getContext("2d"),renderTarget=0,renderSource=131072,colors=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,q.width=p,q.height=y;var T=ctx.getImageData(0,0,p,y),M=new ArrayBuffer(T.data.length),g=new Uint8Array(M),D=new Uint32Array(M),k=new Uint8ClampedArray(p*y*8);states={},init=(()=>{last=0,dt=0,now=0,t=0,moveX=0,speedFactor=.6,songTrigger=!1,state="menu",demostate=0,h=new AudioContext,fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",loop()}),stopCapture=(e=>{}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("mousedown",function(e){stopCapture(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{let o=(new Date).getTime();dt=Math.min(1,(o-last)/1e3),t+=dt,states[state].render(),states[state].step(dt),last=o,c(),requestAnimationFrame(loop)});new l.i(w);states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(e){renderTarget=0,_(0),v(["GAME OVER",256,80+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",9,27])}},states.menu={step:function(e){Key.isDown(Key.p)&&(state="game")},render:function(e){renderTarget=0,_(0);let o=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)f(256+t+256*Math.cos(4*(e/128+o))+e,256+e+128*Math.sin(4*(t/256+o))+t,t/8%32);v(["LOSTGAME",p/2,40+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",6,21]),v(["PRESS P TO CONTINUE",256,230,2,2,"center","top",1,21])}},states.game={step(e){},render(e){renderTarget=0,_(1);let o=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)f(256+t+256*Math.cos(4*(e/128+o))+e,256+e+128*Math.sin(4*(t/256+o))+t,t/8%32);renderTarget=0,v(["JS13K BOILERPLATE",256,20,2,2,"center","top",1,21])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>