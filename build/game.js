var Stats=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";n=t}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),e(++n%i.children.length)},!1);var r=(performance||Date).now(),o=r,a=0,s=t(new Stats.Panel("FPS","#0ff","#002")),l=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new Stats.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>o+1e3&&(s.update(1e3*a/(t-o),100),o=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:i,setMode:e}};Stats.Panel=function(t,e,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,f=2*a,h=3*a,d=15*a,c=74*a,p=30*a,x=document.createElement("canvas");x.width=s,x.height=l,x.style.cssText="width:80px;height:48px";var g=x.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=e,g.fillText(t,u,f),g.fillRect(h,d,c,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,c,p),{dom:x,update:function(l,y){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=e,g.fillText(o(l)+" "+t+" ("+o(i)+"-"+o(r)+")",u,f),g.drawImage(x,h+a,d,c-a,p,h,d,c-a,p),g.fillRect(h+c-a,d,a,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+c-a,d,a,o((1-l/y)*p))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(t){return Math.sin(6.283184*t)}function n(t){return.00390625*Math.pow(1.059463094,t-128)}function i(t,e){setTimeout(function(){var n=new Uint8Array(t*L*2),i=n.length-2,r=function(){for(var t=new Date,o=0;i>=0;)if(n[i]=0,n[i+1]=128,i-=2,(o+=1)%1e3==0&&new Date-t>z)return void setTimeout(r,0);setTimeout(function(){e(n)},0)};setTimeout(r,0)},0)}function r(t,e,n,i,r){var o=n.fx_delay_time*i>>1,a=n.fx_delay_amt/255,s=0,l=function(){for(var n=new Date,i=0;s<e-o;){var u=4*s,f=4*(s+o),h=t[f]+(t[f+1]<<8)+(t[u+2]+(t[u+3]<<8)-32768)*a;if(t[f]=255&h,t[f+1]=h>>8&255,h=t[f+2]+(t[f+3]<<8)+(t[u]+(t[u+1]<<8)-32768)*a,t[f+2]=255&h,t[f+3]=h>>8&255,++s,(i+=1)%1e3==0&&new Date-n>z)return void setTimeout(l,0)}setTimeout(r,0)};setTimeout(l,0)}function o(){tt=N,c(3,7,17,9,8),c(2,8,19,7,8),c(4,9,15,5,2),c(6,11,2,1,16),c(16,11,2,1,16),f(7,12,8,12,21),f(17,12,18,12,21),f(12,6,12,3,5),l(12,3,21),c(10,17,3,1,5),c(8,19,7,7,5),c(9,23,5,5,0),d(11,28,5,13),c(10,22,2,5,8),d(11,28,3,8),h(11,28,1,5),m(11,19,18,27,21,23,8)}function a(t){lt.fill(t,tt,tt+U)}function l(t,e,n){e|=0,n|=0,(t|=0)>0&&t<P&&e>0&&e<F&&(lt[tt+e*P+t]=n)}function u(t,e,n=tt){return lt[n+t+e*P]}function f(t,e,n,i,r){var o,a,s=(i|=0)-(e|=0),u=(n|=0)-(t|=0);if(s<0?(s=-s,a=-1):a=1,u<0?(u=-u,o=-1):o=1,s<<=1,u<<=1,l(t,e,r),u>s)for(var f=s-(u>>1);t!=n;)f>=0&&(e+=a,f-=u),f+=s,l(t+=o,e,r);else for(f=u-(s>>1);e!=i;)f>=0&&(t+=o,f-=s),f+=u,l(t,e+=a,r)}function h(t,e,n,i){var r=-n,o=0,a=2-2*n;do{l(t-r,e+o,i),l(t-o,e-r,i),l(t+r,e-o,i),l(t+o,e+r,i),(n=a)<=o&&(a+=2*++o+1),(n>r||a>o)&&(a+=2*++r+1)}while(r<0)}function d(t,e,n,i){if(!(n<0)){t|=0,e|=0,i|=0;var r=-(n|=0),o=0,a=2-2*n;do{f(t-r,e-o,t+r,e-o,i),f(t-r,e+o,t+r,e+o,i),(n=a)<=o&&(a+=2*++o+1),(n>r||a>o)&&(a+=2*++r+1)}while(r<0)}}function c(t,e,n,i,r){x1=0|t,y1=0|e,x2=t+n|0,y2=e+i|0;var o=Math.abs(y2-y1);if(f(x1,y1,x2,y1,r),o>0)for(;--o;)f(x1,y1+o,x2,y1+o,r);f(x1,y2,x2,y2,r)}function p(t,e,n,i,r,o){for(let a=0;a<=r;a++)c(t+a,e-a,n-2*a,i+2*a,o)}function g(t,e,n,i=n,r=n,o=n){for(let a=0;a<=P;a++)for(let s=0;s<=F;s++){let l=a-1+s*P,u=a+1+s*P,f=a+(s+1)*P,h=a+(s-1)*P;lt[t+(a+s*P)]&&(lt[t+l]||(lt[e+l]=n),lt[t+u]||(lt[e+u]=r),lt[t+h]||(lt[e+h]=i),lt[t+f]||(lt[e+f]=o))}}function m(t,e,n,i,r,o,a){var s=P,t=Math.round(16*t),n=Math.round(16*n),r=Math.round(16*r),e=Math.round(16*e),l=t-n,u=(i=Math.round(16*i))-e,f=n-r,h=(o=Math.round(16*o))-i,d=r-t,c=e-o,p=Math.max(Math.min(t,n,r)+15>>4,0),x=Math.min(Math.max(t,n,r)+15>>4,P),g=Math.max(Math.min(e,i,o)+15>>4,0),y=Math.min(Math.max(e,i,o)+15>>4,F);p&=-8,g&=-8;var m=-u*t-l*e,v=-h*n-f*i,w=-c*r-d*o;(u>0||0==u&&l>0)&&m++,(h>0||0==h&&f>0)&&v++,(c>0||0==c&&d>0)&&w++,m=m-1>>4,v=v-1>>4,w=w-1>>4;var R=0,I=0,S=0,M=0,_=0,b=0;l>=0?I-=7*l:R-=7*l,u>=0?I-=7*u:R-=7*u,f>=0?M-=7*f:S-=7*f,h>=0?M-=7*h:S-=7*h,d>=0?b-=7*d:_-=7*d,c>=0?b-=7*c:_-=7*c;for(var T=s-8,D=g;D<y;D+=8)for(var A=p;A<x;A+=8){var K=m+l*D+u*A,k=v+f*D+h*A,B=w+d*D+c*A;if(!(K<I||k<M||B<b)){var E=A+D*s;if(K>=R&&k>=S&&B>=_)for(L=0;L<8;L++){for(U=0;U<8;U++,E++)lt[tt+E]=a;E+=T}else for(var L=0;L<8;L++){for(var z=K,G=k,C=B,U=0;U<8;U++)(z|G|C)>=0&&(lt[tt+E]=a),z+=u,G+=h,C+=c,E++;K+=l,k+=f,B+=d,E+=T}}}}function v(t=0,e=0,n=384,i=256,r=0,o=0,a=!1,s=!1){for(var l=0;l<i;l++)for(var u=0;u<n;u++)o+l<F&&r+u<P&&o+l>-1&&r+u>-1&&(a&s?lt[et+((e+(i-l))*P+t+(n-u))]>0&&(lt[tt+((o+l)*P+r+u)]=it[lt[et+((e+(i-l))*P+t+(n-u))]]):s&&!a?lt[et+((e+(i-l))*P+t+u)]>0&&(lt[tt+((o+l)*P+r+u)]=lt[et+((e+(i-l))*P+t+u)]):a&&!s?lt[et+((e+l)*P+t+(n-u))]>0&&(lt[tt+((o+l)*P+r+u)]=lt[et+((e+l)*P+t+(n-u))]):a||s||lt[et+((e+l)*P+t+u)]>0&&(lt[tt+((o+l)*P+r+u)]=it[lt[et+((e+l)*P+t+u)]]))}function w(t,e,n,i,r,o,a,s){s*=.0174533;var l=t+n/2,u=e+i/2,f=n*a/2*1.41421356237|5,h=i*a/2*1.41421356237|5,d=-f,c=f,p=-h,x=h,g=1/a,y=Math.cos(-s)*g,m=Math.sin(-s)*g;for(let t=p;t<x;t++)for(let e=d;e<c;e++){let a=l+Math.round(y*e+m*t),s=u+Math.round(-m*e+y*t),f=e+r|0,h=t+o|0;a>=0&&s>=0&&a<n&&s<i&&lt[et+(s*P+a)]>0&&(lt[tt+(h*P+f)]=lt[et+(s*P+a)])}}function R(t,e,n,i,r,o,a){r=r||8,n/=o=o||8,i/=r;for(var s=0;s<r;++s)for(var l=0,u=o/2;l<u;++l)c(t+(2*l*n+(s%2?0:n)),s*i,n-1,i-1,a)}function I(){for(var t=U;t--;)st[t]=nt[it[lt[t]]];rt.data.set(at),$.putImageData(rt,0,0)}function S(t){switch(tt=O,a(0),tt=X,a(0),tt=H,a(0),tt=V,a(0),tt=J,a(0),tt=Y,a(0),t){case ut:currentRoom[0]--,currentRoom[0]<0&&(currentRoom[0]=gt),console.log(currentRoom);break;case ft:currentRoom[0]++,currentRoom[0]>gt&&(currentRoom[0]=0),console.log(currentRoom);break;case ht:currentRoom[1]--,currentRoom[1]<0&&(currentRoom[1]=yt),console.log(currentRoom);break;case ct:currentRoom[1]++,currentRoom[1]>yt&&(currentRoom[1]=0),console.log(currentRoom)}tt=O,rooms[world[currentRoom[1]*(gt+1)+currentRoom[0]]].draw()}function M(){tt=W,a(0);let t=5e3;for(;--t;)l(B.nextIntRange(0,384),B.nextIntRange(0,256),1);for(t=200;--t;)l(B.nextIntRange(0,384),B.nextIntRange(0,256),26);for(t=60;--t;)l(B.nextIntRange(0,384),B.nextIntRange(0,256),20);for(t=20;--t;)l(B.nextIntRange(0,384),B.nextIntRange(0,256),21);for(t=3;--t;)d(B.nextIntRange(0,384),B.nextIntRange(0,256),B.nextIntRange(2,5),B.nextIntRange(16,19))}function _(){let t=U;for(;--t;)if(lt[O+t]==xt){let e=t/P|0,n=t%P;d(n,e,3,9),h(n,e,3,11)}}function b(){et=O,tt=X,a(0);t=3e3;for(B.setSeed(1019);--t;){let t=B.nextIntRange(0,P),e=B.nextIntRange(0,F);u(t,e,O)==pt&&p(t+B.nextIntRange(-5,0),e+B.nextIntRange(-10,0),B.nextIntRange(0,15),B.nextIntRange(0,10),1,B.nextIntRange(22,24))}tt=H,a(0),g(X,H,25,20,26,2),tt=J,et=X,v(),et=H,v(),tt=X,a(0);var t=3e3;for(B.setSeed(1019);--t;){let t=B.nextIntRange(0,P),e=B.nextIntRange(0,F);lt[O+t+e*P]==pt&&p(t+B.nextIntRange(-5,0),e+B.nextIntRange(-10,0),B.nextIntRange(0,15),B.nextIntRange(0,10),1,B.nextIntRange(22,24))}tt=H,a(0),g(X,H,25,20,26,2),tt=J,et=X,v(),et=H,v()}function T(){tt=X,a(0);var t=1e3;for(B.setSeed(1019);--t;){let t=B.nextIntRange(0,P),e=B.nextIntRange(0,F);lt[O+t+e*P]==pt&&(c(t+B.nextIntRange(-5,0),e+B.nextIntRange(-20,0),B.nextIntRange(0,5),B.nextIntRange(0,20),B.nextIntRange(22,24)),d(t,e-10,2,B.nextIntRange(22,24)))}tt=H,a(0),g(X,H,25,20,26,2),tt=V,et=X,v(),et=H,v()}function D(t=0,e=0,n=10,i=10,r=21,o=!1){this.x=t,this.y=e,this.maxSize=n,this.speed=10,this.counter=this.speed,this.color=r,this.size=1,this.filled=o,s=this}function A(t){for(var e=t[0].length,n=0;n<e;n++){var i=[];i=k(t[0].charAt(n));for(var r=0;r<5;r++)for(var o=0;o<5;o++)1==i[5*r+o]&&(1==t[4]?l(t[1]+o*t[4]+(5*t[4]+t[3])*n,t[2]+r*t[4],t[5]):c(t[1]+o*t[4]+(5*t[4]+t[3])*n,t[2]+r*t[4],t[4],t[4],t[5]))}}function K(t){var e=5*t[7],n=t[0].split("\n"),i=n.slice(0),r=n.length,o=i.sort(function(t,e){return e.length-t.length})[0],a=o.length*e+(o.length-1)*t[3],s=r*e+(r-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var l=t[1],u=t[2],f=t[1]+a,h=t[2]+s;"center"==t[5]?(l=t[1]-a/2,f=t[1]+a/2):"right"==t[5]&&(l=t[1]-a,f=t[1]),"center"==t[6]?(u=t[2]-s/2,h=t[2]+s/2):"bottom"==t[6]&&(u=t[2]-s,h=t[2]);for(var d=l+a/2,c=u+s/2,p=0;p<r;p++){var x=n[p],g=x.length*e+(x.length-1)*t[3],y=t[1],m=t[2]+(e+t[4])*p;"center"==t[5]?y=t[1]-g/2:"right"==t[5]&&(y=t[1]-g),"center"==t[6]?m-=s/2:"bottom"==t[6]&&(m-=s),A([x,y,m,t[3]||0,t[7]||1,t[8],t[9]])}return{sx:l,sy:u,cx:d,cy:c,ex:f,ey:h,width:a,height:s}}function k(t){return index=fontString.indexOf(t),fontBitmap.substring(25*index,25*index+25).split("")}var B={seed:Date.now(),a:1664525,c:1013904223,m:Math.pow(2,32),setSeed:function(t){this.seed=t},nextInt:function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},nextFloat:function(){return this.nextInt()/this.m},nextBool:function(t){return null==t&&(t=.5),this.nextFloat()<t},nextFloatRange:function(t,e){return t+this.nextFloat()*(e-t)},nextIntRange:function(t,e){return Math.floor(this.nextFloatRange(t,e))},nextColor:function(){for(var t=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();t.length<6;)t="0"+t;return"#"+t}},E={},L=2,z=33,G=null,C=[e,function(t){return e(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];E.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/L/2},E.AudioGenerator.prototype.getAudioBuffer=function(t){null===G&&(G=new AudioContext);var e=this.mixBuf,n=this.waveSize*L*2,i=G.createBuffer(L,this.waveSize,44100),r=i.getChannelData(0),o=i.getChannelData(1),a=0,s=function(){for(var l=new Date,u=0;a<n/2;){var f=4*(e[4*a]+(e[4*a+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,r[a]=f/32768,f=4*(e[4*a+2]+(e[4*a+3]<<8)-32768),f=f<-32768?-32768:f>32767?32767:f,o[a]=f/32768,a+=1,(u+=1)%1e3==0&&new Date-l>z)return void setTimeout(s,0)}setTimeout(function(){t(i)},0)};setTimeout(s,0)},E.SoundGenerator=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=C[t.lfo_waveform],this.osc1=C[t.osc1_waveform],this.osc2=C[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen},E.SoundGenerator.prototype.genSound=function(t,i,r){new Date;for(var o=0,a=0,s=n(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=n(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),u=this.instr.fx_resonance/255,f=0,h=0,d=this.attack+this.sustain+this.release-1;d>=0;--d){var c=d+r,p=this.osc_lfo(c*this.lfoFreq)*this.instr.lfo_amt/512+.5,x=1;d<this.attack?x=d/this.attack:d>=this.attack+this.sustain&&(x-=(d-this.attack-this.sustain)/this.release);var g=s;this.instr.lfo_osc1_freq&&(g+=p),this.instr.osc1_xenv&&(g*=x*x),o+=g;var y=this.osc1(o)*this.instr.osc1_vol;g=l,this.instr.osc2_xenv&&(g*=x*x),a+=g,y+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(y+=(2*Math.random()-1)*this.instr.noise_fader*x),y*=x/255;var m=this.instr.fx_freq;this.instr.lfo_fx_freq&&(m*=p);var v=u*(y-h)-(f+=(m=1.5*Math.sin(3.141592*m/44100))*h);switch(h+=m*v,this.instr.fx_filter){case 1:y=v;break;case 2:y=f;break;case 3:y=h;break;case 4:y=f+v}if(g=e(c*this.panFreq)*this.instr.fx_pan_amt/512+.5,y*=39*this.instr.env_master,(c*=4)+3<i.length){var w=i[c]+(i[c+1]<<8)+y*(1-g);i[c]=255&w,i[c+1]=w>>8&255,w=i[c+2]+(i[c+3]<<8)+y*g,i[c+2]=255&w,i[c+3]=w>>8&255}}},E.SoundGenerator.prototype.getAudioGenerator=function(t,e){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;i(n,function(i){o.genSound(t,i,0),r(i,n,o.instr,o.rowLen,function(){e(new E.AudioGenerator(i))})})},E.SoundGenerator.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})},E.MusicGenerator=function(t){this.song=t,this.waveSize=44100*t.songLen},E.MusicGenerator.prototype.generateTrack=function(t,e,n){var o=this;i(this.waveSize,function(i){var a=o.waveSize,s=o.waveSize*L*2,l=o.song.rowLen,u=o.song.endPattern,f=new E.SoundGenerator(t,l),h=0,d=0,c=0,p=function(){for(var e=new Date;;)if(32!==c){if(d===u-1)return void setTimeout(x,0);var n=t.p[d];if(n){var r=t.c[n-1].n[c];r&&f.genSound(r,i,h)}if(h+=l,c+=1,new Date-e>z)return void setTimeout(p,0)}else c=0,d+=1},x=function(){r(i,a,t,l,y)},g=0,y=function(){for(var t=new Date,r=0;g<s;){var o=e[g]+(e[g+1]<<8)+i[g]+(i[g+1]<<8)-32768;if(e[g]=255&o,e[g+1]=o>>8&255,g+=2,(r+=1)%1e3==0&&new Date-t>z)return void setTimeout(y,0)}setTimeout(n,0)};setTimeout(p,0)})},E.MusicGenerator.prototype.getAudioGenerator=function(t){var e=this;i(this.waveSize,function(n){var i=0,r=function(){i<e.song.songData.length?(i+=1,e.generateTrack(e.song.songData[i-1],n,r)):t(new E.AudioGenerator(n))};r()})},E.MusicGenerator.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})};fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";const P=384,F=256,U=P*F,q=0,Y=U,j=2*U,X=3*U,H=4*U,N=5*U,O=6*U,J=7*U,V=8*U,W=9*U,Q=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];var Z=document.getElementById("canvas"),$=Z.getContext("2d"),tt=0,et=U,nt=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],it=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];paldrk=[0,0,1,2,3,4,5,6,6,10,11,12,13,14,2,2,15,16,17,18,22,20,23,24,25,26,2,2,27,28,31,13],$.imageSmoothingEnabled=!1,$.mozImageSmoothingEnabled=!1,Z.width=P,Z.height=F;var rt=$.getImageData(0,0,P,F),ot=new ArrayBuffer(rt.data.length),at=new Uint8Array(ot),st=new Uint32Array(ot),lt=new Uint8ClampedArray(P*F*10);Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};const ut=1,ft=2,ht=3,ct=4,pt=21,xt=8;states={},init=(()=>{o(),sounds={},soundsLoaded=0,totalSounds=1,score=0,fuelAmount=12e9,fuelTimer=30,parts=0,last=0,dt=0,now=0,t=0,songTrigger=!1,state="menu",G=new AudioContext,paused=!1,transition=!1,splodes=[],player.init(),stats=new Stats,document.body.appendChild(stats.dom),loop()}),window.addEventListener("keyup",function(t){Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){Key.onKeydown(t)},!1),window.addEventListener("blur",function(t){paused=!0},!1),window.addEventListener("focus",function(t){paused=!1},!1),loop=(e=>{if(stats.begin(),paused)it=paldrk,K(["PAUSED",192,128,1,1,1,"center",1,21,0]);else{it=Q;let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3),t+=dt,states[state].step(dt),last=e,states[state].render()}I(),stats.end(),requestAnimationFrame(loop)}),world=[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,7,6,6,8,6,6,6];const gt=9,yt=5;currentRoom=[0,1],rooms=[{draw:function(t){M(),b(),T()}},{draw:function(t){d(192,128,50,pt),M(),b(),T()}},{draw:function(t){h(192,128,64,pt),M(),b(),T()}},{draw:function(t){c(0,0,127,256,pt),c(250,0,127,256,pt),M(),b(),T()}},{draw:function(t){c(0,0,127,256,pt),c(250,0,127,256,pt),M(),b(),T()}},{draw:function(t){}},{draw:function(t){c(0,205,384,100,pt);let e=100;for(;--e;)x=B.nextIntRange(0,P),y=B.nextIntRange(100,200),l(x,y,xt);M(),b(),T()}},{draw:function(t){m(0,256,384,256,182,205,pt),c(100,70,20,80,pt),c(100,140,100,20,pt),c(200,820,10,100,pt),c(210,70,100,100,pt),M(),b(),T()}},{draw:function(t){c(0,205,384,10,pt),d(250,150,64,pt),l(50,180,xt),M(),b(),T()}}],M(),b(),T(),player={init(){this.x=192,this.y=30,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=200,this.yspeed=200,this.drag=.8,this.gravity=8,this.maxYvel=400,this.maxXvel=400,this.minYvel=-400,this.minXvel=-400,this.b={},this.facingLeft=!1,this.jumping=!1},update(t){this.updateB(),this.oldX=this.x,this.oldY=this.y,this.xvel*=player.drag,this.yvel+=player.gravity,this.yvel=this.yvel.clamp(this.minYvel,this.maxYvel),this.xvel=this.xvel.clamp(this.minXvel,this.maxXvel);let e=t*player.xvel,n=t*player.yvel;player.x+=e,this.updateB(),this.collides()&&(player.x=player.oldX,player.xvel=.4*-player.xvel),player.y+=n,this.updateB(),this.collides()&&(player.y=player.oldY,player.yvel=.4*-player.yvel),this.updateB(),this.collides()&&(this.x+=this.collideResolutionX(),this.updateB(),this.collides()&&(this.y+=this.collideResolutionY(),this.updateB())),this.overlapResolution(),this.updateB(),(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(player.facingLeft=!1,player.xvel=player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(this.facingLeft=!0,player.xvel=-player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&!this.jumping&&fuelTimer>0&&(player.yvel=-player.yspeed),player.x>P&&(player.x=0,S(ft)),player.x<0&&(player.x=P,S(ut)),player.y>F&&(player.y=0,S(ct)),player.y<0&&(player.y=F,S(ht))},draw(t){et=N,tt=Y,v(0,0,19,34,this.x-this.radius|0,this.y-this.radius-12|0,this.facingLeft)},collides(){for(var t=-this.radius;t<this.radius;t++)for(var e=-this.radius;e<this.radius;e++)if(lt[O+(this.b.x+t)+(this.b.y+e)*P]==pt)return!0;return!1},overlaps(){for(var t=-this.radius;t<this.radius;t++)for(var e=-this.radius;e<this.radius;e++){let n=lt[O+(this.b.x+t)+(this.b.y+e)*P];if(n)return{x:this.b.x+t,y:this.b.y+e,o:n}}return!1},updateB(){this.b={left:this.x-this.radius|0,right:this.x+this.radius|0,top:this.y-this.radius|0,bottom:this.y+this.radius|0,width:2*this.radius,height:2*this.radius,x:0|this.x,y:0|this.y}},collideResolutionY(t){let e=0,n=this.b;for(let t=n.left;t<=n.right;t++)if(lt[O+t+P*n.bottom]==pt)for(let i=n.bottom;i>=n.top;i--)lt[O+t+P*i]==pt&&(e=i-n.bottom-1);for(let t=n.left;t<=n.right;t++)if(lt[O+t+P*n.top]==pt)for(let i=n.top;i<=n.bottom;i++)lt[O+t+P*i]==pt&&(e=i-n.top+1);return e},collideResolutionX(t){let e=0,n=this.b;for(let t=n.top;t<=n.bottom;t++)if(lt[O+n.left+P*t]==pt)for(let i=n.x;i<=n.right;i++)lt[O+i+P*t]==pt&&e++;else if(lt[O+n.right+P*t]==pt)for(let i=n.x;i>=n.left;i--)lt[O+i+P*t]==pt&&e--;for(let t=n.top+2;t<=n.bottom-2;t++)if(lt[O+n.right+P*t])for(let i=n.left;i<=n.right;i++)lt[O+i+P*t]&&(e=30);return e},overlapResolution(t){let e=player.overlaps();switch(e.o){case xt:lt[O+e.x+e.y*P],tt=O,d(e.x,e.y,3,0),tt=Y,splodes.push(new D(e.x,e.y)),fuelTimer+=1,console.log(fuelAmount,e.x,e.y)}}},D.prototype.draw=function(){++this.size>this.maxSize||(this.filled?d(this.x,this.y,this.size,this.color):h(this.x,this.y,this.size,this.color),0==--this.counter&&(this.size++,this.counter=this.speed))},states.gameover={step:function(t){Key.isDown(Key.r)&&(state="menu")},render:function(t){tt=0,a(0),K(["CRITICAL SYSTEM\nFAILURE",192,80,8,15,"center","top",3,27])}},states.menu={step:function(t){Key.justReleased(Key.p)&&(S(),state="game"),Key.justReleased(Key.z)&&(state="spritesheet")},render:function(e){tt=O,a(0),tt=0,a(0),tt=Y,a(0),tt=X,a(0),tt=q,a(0),tt=O,K(["GREEBLE",P/2,150,20,20,"center","top",6,25]),tt=Y,et=O,v(),tt=H,B.setSeed(21);for(n=6e3;--n;){let t=B.nextIntRange(0,P),e=B.nextIntRange(0,F);lt[O+t+e*P]&&c(t+B.nextIntRange(-2,2),e+B.nextIntRange(-1,1),1,B.nextIntRange(0,3),B.nextIntRange(24,25))}g(H,X,25,20,23,18),tt=Y,et=H,v(),et=X,v(),tt=H,B.setSeed(20);for(var n=6e3;--n;){let t=B.nextIntRange(0,P),e=B.nextIntRange(0,F);lt[O+t+e*P]&&c(t+B.nextIntRange(-1,1),e+B.nextIntRange(0,1),B.nextIntRange(1,5),1,B.nextIntRange(22,24))}g(H,X,25,20,23,18),tt=Y,et=H,v(),et=X,v(),player.draw(),et=N;let i=8;for(;--i;)v(0,0,25,36,192+25*i,40);w(1,1,25,36,64,64,1,45),K(["PRESS P TO CONTINUE",P/2,230,2,2,"center","top",1,21]),tt=q;for(r=8e3;--r;)l((B.nextIntRange(0,384)+10*t|0)%384,B.nextIntRange(0,256),1);for(r=400;--r;)l((B.nextIntRange(0,384)+20*t|0)%384,B.nextIntRange(0,256),26);for(var r=100;--r;)l((B.nextIntRange(0,384)+30*t|0)%384,B.nextIntRange(0,256),21);g(Y,q,15),et=Y,v()}},states.game={step(t){Key.justReleased(Key.f)&&(state="gameover"),player.update(t),fuelTimer-=t,fuelTimer<0&&(fuelTimer=0)},render(t){if(tt=q,a(0),et=W,v(),tt=Y,a(0),_(),et=J,v(),player.draw(),et=V,v(),tt=q,fuelTimer)if(fuelTimer>20)et=Y,v(),et=j,v();else{tt=q,a(0);let t=1e3;for(;t--;)l(Math.random()*P,Math.random()*F,2);g(Y,q,9)}else{tt=q,a(0);let t=2e3;for(;t--;){let t=Math.random()*P|0,e=Math.random()*F|0;h(t,e,1,lt[Y+t+e*P]?27:0)}}K([fuelTimer.toString(),192,10,1,1,1,"center",1,9,0]),splodes.forEach(function(t){t.draw()})}},states.spritesheet={step:function(t){Key.justReleased(Key.x)&&(S(),state="menu")},render:function(e){tt=q,a(0),R(0,0,384,256,8,12,1),et=N,v(),v(0,0,22,34,200,200),w(0,0,32,32,192,128,2,15+90*t);for(var n=0;n<32;n++)K([n.toString(),n<16?3+16*n:3+16*(n-16),n<16?40:56,1,1,1,"left",1,n,0])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}},window.onload=init()}();